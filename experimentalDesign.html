<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />


<meta name="author" content="Lieven Clement" />


<title>Experimental design concepts for label-free proteomics experiments</title>

<script src="site_libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<meta name="viewport" content="width=device-width, initial-scale=1" />
<link href="site_libs/bootstrap-3.3.5/css/cosmo.min.css" rel="stylesheet" />
<script src="site_libs/bootstrap-3.3.5/js/bootstrap.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/html5shiv.min.js"></script>
<script src="site_libs/bootstrap-3.3.5/shim/respond.min.js"></script>
<style>h1 {font-size: 34px;}
       h1.title {font-size: 38px;}
       h2 {font-size: 30px;}
       h3 {font-size: 24px;}
       h4 {font-size: 18px;}
       h5 {font-size: 16px;}
       h6 {font-size: 12px;}
       code {color: inherit; background-color: rgba(0, 0, 0, 0.04);}
       pre:not([class]) { background-color: white }</style>
<script src="site_libs/jqueryui-1.11.4/jquery-ui.min.js"></script>
<link href="site_libs/tocify-1.9.1/jquery.tocify.css" rel="stylesheet" />
<script src="site_libs/tocify-1.9.1/jquery.tocify.js"></script>
<script src="site_libs/navigation-1.1/tabsets.js"></script>
<script src="site_libs/navigation-1.1/codefolding.js"></script>
<script src="site_libs/navigation-1.1/sourceembed.js"></script>
<script src="site_libs/accessible-code-block-0.0.1/empty-anchor.js"></script>
<link href="site_libs/pagedtable-1.1/css/pagedtable.css" rel="stylesheet" />
<script src="site_libs/pagedtable-1.1/js/pagedtable.js"></script>
<link href="site_libs/font-awesome-5.1.0/css/all.css" rel="stylesheet" />
<link href="site_libs/font-awesome-5.1.0/css/v4-shims.css" rel="stylesheet" />

<style type="text/css">
  code{white-space: pre-wrap;}
  span.smallcaps{font-variant: small-caps;}
  span.underline{text-decoration: underline;}
  div.column{display: inline-block; vertical-align: top; width: 50%;}
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
  ul.task-list{list-style: none;}
    </style>


<style type="text/css">
  code {
    white-space: pre;
  }
  .sourceCode {
    overflow: visible;
  }
</style>
<style type="text/css" data-origin="pandoc">
code.sourceCode > span { display: inline-block; line-height: 1.25; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode { white-space: pre; position: relative; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
code.sourceCode { white-space: pre-wrap; }
code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #c4a000; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #000000; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #000000; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #000000; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */

</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    for (var j = 0; j < rules.length; j++) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") continue;
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') continue;
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>


<style type="text/css">
#rmd-source-code {
  display: none;
}
</style>





<style type = "text/css">
.main-container {
  max-width: 940px;
  margin-left: auto;
  margin-right: auto;
}
img {
  max-width:100%;
}
.tabbed-pane {
  padding-top: 12px;
}
.html-widget {
  margin-bottom: 20px;
}
button.code-folding-btn:focus {
  outline: none;
}
summary {
  display: list-item;
}
pre code {
  padding: 0;
}
</style>


<style type="text/css">
.dropdown-submenu {
  position: relative;
}
.dropdown-submenu>.dropdown-menu {
  top: 0;
  left: 100%;
  margin-top: -6px;
  margin-left: -1px;
  border-radius: 0 6px 6px 6px;
}
.dropdown-submenu:hover>.dropdown-menu {
  display: block;
}
.dropdown-submenu>a:after {
  display: block;
  content: " ";
  float: right;
  width: 0;
  height: 0;
  border-color: transparent;
  border-style: solid;
  border-width: 5px 0 5px 5px;
  border-left-color: #cccccc;
  margin-top: 5px;
  margin-right: -10px;
}
.dropdown-submenu:hover>a:after {
  border-left-color: #adb5bd;
}
.dropdown-submenu.pull-left {
  float: none;
}
.dropdown-submenu.pull-left>.dropdown-menu {
  left: -100%;
  margin-left: 10px;
  border-radius: 6px 0 6px 6px;
}
</style>

<script type="text/javascript">
// manage active state of menu based on current page
$(document).ready(function () {
  // active menu anchor
  href = window.location.pathname
  href = href.substr(href.lastIndexOf('/') + 1)
  if (href === "")
    href = "index.html";
  var menuAnchor = $('a[href="' + href + '"]');

  // mark it active
  menuAnchor.tab('show');

  // if it's got a parent navbar menu mark it active as well
  menuAnchor.closest('li.dropdown').addClass('active');

  // Navbar adjustments
  var navHeight = $(".navbar").first().height() + 15;
  var style = document.createElement('style');
  var pt = "padding-top: " + navHeight + "px; ";
  var mt = "margin-top: -" + navHeight + "px; ";
  var css = "";
  // offset scroll position for anchor links (for fixed navbar)
  for (var i = 1; i <= 6; i++) {
    css += ".section h" + i + "{ " + pt + mt + "}\n";
  }
  style.innerHTML = "body {" + pt + "padding-bottom: 40px; }\n" + css;
  document.head.appendChild(style);
});
</script>

<!-- tabsets -->

<style type="text/css">
.tabset-dropdown > .nav-tabs {
  display: inline-table;
  max-height: 500px;
  min-height: 44px;
  overflow-y: auto;
  border: 1px solid #ddd;
  border-radius: 4px;
}

.tabset-dropdown > .nav-tabs > li.active:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li.active:before {
  content: "&#xe258;";
  border: none;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open:before {
  content: "";
  font-family: 'Glyphicons Halflings';
  display: inline-block;
  padding: 10px;
  border-right: 1px solid #ddd;
}

.tabset-dropdown > .nav-tabs > li.active {
  display: block;
}

.tabset-dropdown > .nav-tabs > li > a,
.tabset-dropdown > .nav-tabs > li > a:focus,
.tabset-dropdown > .nav-tabs > li > a:hover {
  border: none;
  display: inline-block;
  border-radius: 4px;
  background-color: transparent;
}

.tabset-dropdown > .nav-tabs.nav-tabs-open > li {
  display: block;
  float: none;
}

.tabset-dropdown > .nav-tabs > li {
  display: none;
}
</style>

<!-- code folding -->
<style type="text/css">
.code-folding-btn { margin-bottom: 4px; }
</style>



<style type="text/css">

#TOC {
  margin: 25px 0px 20px 0px;
}
@media (max-width: 768px) {
#TOC {
  position: relative;
  width: 100%;
}
}

@media print {
.toc-content {
  /* see https://github.com/w3c/csswg-drafts/issues/4434 */
  float: right;
}
}

.toc-content {
  padding-left: 30px;
  padding-right: 40px;
}

div.main-container {
  max-width: 1200px;
}

div.tocify {
  width: 20%;
  max-width: 260px;
  max-height: 85%;
}

@media (min-width: 768px) and (max-width: 991px) {
  div.tocify {
    width: 25%;
  }
}

@media (max-width: 767px) {
  div.tocify {
    width: 100%;
    max-width: none;
  }
}

.tocify ul, .tocify li {
  line-height: 20px;
}

.tocify-subheader .tocify-item {
  font-size: 0.90em;
}

.tocify .list-group-item {
  border-radius: 0px;
}


</style>



</head>

<body>


<div class="container-fluid main-container">


<!-- setup 3col/9col grid for toc_float and main content  -->
<div class="row">
<div class="col-xs-12 col-sm-4 col-md-3">
<div id="TOC" class="tocify">
</div>
</div>

<div class="toc-content col-xs-12 col-sm-8 col-md-9">




<div class="navbar navbar-inverse  navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar">
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <a class="navbar-brand" href="index.html">hupo21</a>
    </div>
    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    <span class="fa fa-chalkboard-teacher"></span>
     
    Lectures
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="sourcesOfVariability.html">Sources of Variability</a>
    </li>
    <li>
      <a href="experimentalDesign.html">Experimental Design</a>
    </li>
    <li>
      <a href="msqrob2guiTutorial.html">msqrob2 tutorial</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        <li>
  <a href="https://github.com/statOmics/hupo21">
    <span class="fab fa-github"></span>
     
  </a>
</li>
<li>
  <a href="http://statomics.github.io/">statOmics</a>
</li>
      </ul>
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

<div id="header">

<div class="btn-group pull-right float-right">
<button type="button" class="btn btn-default btn-xs btn-secondary btn-sm dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false"><span>Code</span> <span class="caret"></span></button>
<ul class="dropdown-menu dropdown-menu-right" style="min-width: 50px;">
<li><a id="rmd-download-source" href="#">Download Rmd</a></li>
</ul>
</div>



<h1 class="title toc-ignore">Experimental design concepts for label-free proteomics experiments</h1>
<h4 class="author">Lieven Clement</h4>
<h4 class="date"><a href="https://statomics.github.io">statOmics</a>, Ghent University</h4>

</div>


<p><a rel="license" href="https://creativecommons.org/licenses/by-nc-sa/4.0"><img alt="Creative Commons License" style="border-width:0" src="https://i.creativecommons.org/l/by-nc-sa/4.0/88x31.png" /></a></p>
<p>This is part of the online course <a href="https://statomics.github.io/hupo21/">Experimental Design and Data-Analysis in Label-Free Quantitative LC/MS Proteomics - A Tutorial with msqrob2 (hupo21)</a></p>
<details>
<summary> Click to see libraries that are loaded </summary>
<p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2"></a><span class="kw">library</span>(limma)</span>
<span id="cb1-3"><a href="#cb1-3"></a><span class="kw">library</span>(QFeatures)</span>
<span id="cb1-4"><a href="#cb1-4"></a><span class="kw">library</span>(msqrob2)</span>
<span id="cb1-5"><a href="#cb1-5"></a><span class="kw">library</span>(plotly)</span>
<span id="cb1-6"><a href="#cb1-6"></a><span class="kw">library</span>(gridExtra)</span></code></pre></div>
</p>
</details>
<div id="overview" class="section level1">
<h1><span class="header-section-number">1</span> Overview</h1>
<ul>
<li>Sample size</li>
<li>Randomized Complete Block Designs</li>
</ul>
</div>
<div id="sample-size" class="section level1">
<h1><span class="header-section-number">2</span> Sample size</h1>
<div id="statistical-models" class="section level2">
<h2><span class="header-section-number">2.1</span> Statistical models</h2>
<ul>
<li>Upon preprocessing and summarization we model the log2 transformed protein expression (<span class="math inline">\(y_{i}\)</span>) values using a linear model</li>
</ul>
<p><span class="math display">\[y_{i}= \beta_0 + \beta_1 x_{i,1} + \beta x_{i,2} + ... + \epsilon_i\]</span></p>
<p>with</p>
<ul>
<li><span class="math inline">\(\beta_0\)</span> the intercept</li>
<li><span class="math inline">\(\beta_j\)</span> the slope for predictor <span class="math inline">\(x_{i,j}\)</span></li>
<li><span class="math inline">\(x_{i,j}\)</span> a continuous predictor (such as age) or a dummy variable that can take values of 0 and 1 and that will used for factors (e.g treatment: cancer, normal).</li>
</ul>
<p>Example:</p>
<ul>
<li>Estrogen Receptor Positive Breast cancer tissues from from patients treated with tamoxifen upon recurrence have been assessed in a proteomics study.</li>
<li>Half of the patients had a good outcome (or) and the other half had a poor outcome (pd).</li>
<li>The proteomes have been assessed using an LTQ-Orbitrap and the thermo output .RAW files were searched with MaxQuant (version 1.4.1.2) against the human proteome database (FASTA version 2012-09, human canonical proteome).</li>
</ul>
<p>We model the data for a single protein using a model:</p>
<p><span class="math display">\[y_{i}= \beta_0 + \beta_{PD} x_{i,PD} + \epsilon_i\]</span></p>
<p>with <span class="math inline">\(x_{i,PD}=\begin{cases} 0&amp; \text{good outcome}\\ 1&amp; \text{poor outcome} \end{cases}\)</span>.</p>
<div id="read-data" class="section level3">
<h3><span class="header-section-number">2.1.1</span> Read data</h3>
<details>
<summary> Click to see background and code </summary>
<p>
<ol style="list-style-type: decimal">
<li>We use a peptides.txt file from MS-data quantified with maxquant that contains MS1 intensities summarized at the peptide level.</li>
</ol>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1"></a>peptidesFile &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/statOmics/pda21/data/quantification/cancer/peptides3vs3.txt&quot;</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Maxquant stores the intensity data for the different samples in columnns that start with Intensity. We can retreive the column names with the intensity data with the code below:</li>
</ol>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1"></a>ecols &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;Intensity</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="kw">names</span>(<span class="kw">read.delim</span>(peptidesFile)))</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Read the data and store it in QFeatures object</li>
</ol>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1"></a>pe &lt;-<span class="st"> </span><span class="kw">readQFeatures</span>(</span>
<span id="cb4-2"><a href="#cb4-2"></a>  <span class="dt">table =</span> peptidesFile,</span>
<span id="cb4-3"><a href="#cb4-3"></a>  <span class="dt">fnames =</span> <span class="dv">1</span>,</span>
<span id="cb4-4"><a href="#cb4-4"></a>  <span class="dt">ecol =</span> ecols,</span>
<span id="cb4-5"><a href="#cb4-5"></a>  <span class="dt">name =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</span></code></pre></div>
</p>
</details>
</div>
<div id="design" class="section level3">
<h3><span class="header-section-number">2.1.2</span> Design</h3>
<details>
<summary> Click to see background and code </summary>
<p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1"></a>pe <span class="op">%&gt;%</span><span class="st"> </span>colnames</span></code></pre></div>
<pre><code>## CharacterList of length 1
## [[&quot;peptideRaw&quot;]] Intensity.OR.01 Intensity.OR.04 ... Intensity.PD.04</code></pre>
<ul>
<li>Note, that the sample names the outcome.</li>
<li>We update the colData with information on the design</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1"></a><span class="kw">colData</span>(pe)<span class="op">$</span>prognosis &lt;-<span class="st">  </span>pe[[<span class="st">&quot;peptideRaw&quot;</span>]] <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-2"><a href="#cb7-2"></a><span class="st">  </span>colnames <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-3"><a href="#cb7-3"></a><span class="st">  </span><span class="kw">substr</span>(<span class="dv">11</span>,<span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb7-4"><a href="#cb7-4"></a><span class="st">  </span>as.factor</span></code></pre></div>
<ul>
<li>We explore the colData</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1"></a><span class="kw">colData</span>(pe)</span></code></pre></div>
<pre><code>## DataFrame with 6 rows and 1 column
##                 prognosis
##                  &lt;factor&gt;
## Intensity.OR.01        OR
## Intensity.OR.04        OR
## Intensity.OR.07        OR
## Intensity.PD.02        PD
## Intensity.PD.03        PD
## Intensity.PD.04        PD</code></pre>
</p>
</details>
</div>
<div id="preprocessing" class="section level3">
<h3><span class="header-section-number">2.1.3</span> Preprocessing</h3>
<details>
<summary> Click to see code for preprocessing </summary>
<p>
<ol style="list-style-type: decimal">
<li>Log-transform</li>
</ol>
<ul>
<li>We calculate how many non zero intensities we have for each peptide and this can be useful for filtering.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1"></a><span class="kw">rowData</span>(pe[[<span class="st">&quot;peptideRaw&quot;</span>]])<span class="op">$</span>nNonZero &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">assay</span>(pe[[<span class="st">&quot;peptideRaw&quot;</span>]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<ul>
<li>Peptides with zero intensities are missing peptides and should be represent with a <code>NA</code> value rather than <code>0</code>.</li>
</ul>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1"></a>pe &lt;-<span class="st"> </span><span class="kw">zeroIsNA</span>(pe, <span class="st">&quot;peptideRaw&quot;</span>) <span class="co"># convert 0 to NA</span></span></code></pre></div>
<ul>
<li>Logtransform data with base 2</li>
</ul>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1"></a>pe &lt;-<span class="st"> </span><span class="kw">logTransform</span>(pe, <span class="dt">base =</span> <span class="dv">2</span>, <span class="dt">i =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="dt">name =</span> <span class="st">&quot;peptideLog&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Filtering</li>
</ol>
<details>
<summary> Click to see code to filter the data </summary>
<p>
<ul>
<li>Handling overlapping protein groups</li>
</ul>
<p>In our approach a peptide can map to multiple proteins, as long as there is none of these proteins present in a smaller subgroup.</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe, <span class="op">~</span><span class="st"> </span>Proteins <span class="op">%in%</span><span class="st"> </span><span class="kw">smallestUniqueGroups</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;peptideLog&quot;</span>]])<span class="op">$</span>Proteins))</span></code></pre></div>
<ul>
<li>Remove reverse sequences (decoys) and contaminants</li>
</ul>
<p>We now remove the contaminants, peptides that map to decoy sequences, and proteins which were only identified by peptides with modifications.</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe,<span class="op">~</span>Reverse <span class="op">!=</span><span class="st"> &quot;+&quot;</span>)</span>
<span id="cb14-2"><a href="#cb14-2"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe,<span class="op">~</span><span class="st"> </span>Contaminant <span class="op">!=</span><span class="st"> &quot;+&quot;</span>)</span></code></pre></div>
<ul>
<li>Drop peptides that were only identified in one sample</li>
</ul>
<p>We keep peptides that were observed at last twice.</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe,<span class="op">~</span><span class="st"> </span>nNonZero <span class="op">&gt;=</span><span class="dv">2</span>)</span>
<span id="cb15-2"><a href="#cb15-2"></a><span class="kw">nrow</span>(pe[[<span class="st">&quot;peptideLog&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 22413</code></pre>
<p>We keep 22413 peptides upon filtering.</p>
<ol start="3" style="list-style-type: decimal">
<li>Normalization</li>
</ol>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1"></a>pe &lt;-<span class="st"> </span><span class="kw">normalize</span>(pe, </span>
<span id="cb17-2"><a href="#cb17-2"></a>                <span class="dt">i =</span> <span class="st">&quot;peptideLog&quot;</span>, </span>
<span id="cb17-3"><a href="#cb17-3"></a>                <span class="dt">name =</span> <span class="st">&quot;peptideNorm&quot;</span>, </span>
<span id="cb17-4"><a href="#cb17-4"></a>                <span class="dt">method =</span> <span class="st">&quot;center.median&quot;</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Summarization</li>
</ol>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1"></a>pe &lt;-<span class="st"> </span><span class="kw">aggregateFeatures</span>(pe,</span>
<span id="cb18-2"><a href="#cb18-2"></a>  <span class="dt">i =</span> <span class="st">&quot;peptideNorm&quot;</span>,</span>
<span id="cb18-3"><a href="#cb18-3"></a>  <span class="dt">fcol =</span> <span class="st">&quot;Proteins&quot;</span>,</span>
<span id="cb18-4"><a href="#cb18-4"></a>  <span class="dt">na.rm =</span> <span class="ot">TRUE</span>,</span>
<span id="cb18-5"><a href="#cb18-5"></a>  <span class="dt">name =</span> <span class="st">&quot;protein&quot;</span>)</span></code></pre></div>
</p>
</details>
</div>
</div>
<div id="effect-size" class="section level2">
<h2><span class="header-section-number">2.2</span> Effect size?</h2>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1"></a><span class="kw">library</span>(ExploreModelMatrix)</span>
<span id="cb19-2"><a href="#cb19-2"></a><span class="kw">VisualizeDesign</span>(<span class="kw">colData</span>(pe),<span class="dt">designFormula =</span> <span class="op">~</span>prognosis)<span class="op">$</span>plotlist</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="experimentalDesign_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p><span class="math display">\[
\begin{array}{rclcl}
E[Y|OR] &amp;=&amp; \beta_0\\
E[Y|PD] &amp;=&amp; \beta_0 + \beta_{PD}\\
\log_2 FC_{PD-OR} &amp;=&amp;  \beta_0 + \beta_{PD} -  \beta_0 &amp;=&amp;\beta_{PD}
\end{array}
\]</span></p>
</div>
<div id="statistical-inference" class="section level2">
<h2><span class="header-section-number">2.3</span> Statistical Inference</h2>
<p>We want to find proteins that are differential abundant</p>
<p><span class="math inline">\(\rightarrow\)</span> use a statistical test</p>
<ul>
<li><span class="math inline">\(H_0\)</span>: <span class="math inline">\(\log_2 FC_{PD-OR} = 0\)</span> or <span class="math inline">\(\beta_{PD} = 0\)</span></li>
<li><span class="math inline">\(H_1\)</span>: <span class="math inline">\(\log_2 FC_{PD-OR} \neq 0\)</span> or <span class="math inline">\(\beta_{PD} \neq 0\)</span></li>
</ul>
</div>
<div id="experiment-with-3-vs-3-comparison" class="section level2">
<h2><span class="header-section-number">2.4</span> Experiment with 3 vs 3 comparison</h2>
<details>
<summary> Click to see code to inference </summary>
<p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1"></a>pe &lt;-<span class="st"> </span><span class="kw">msqrob</span>(<span class="dt">object =</span> pe, <span class="dt">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="dt">formula =</span> <span class="op">~</span>prognosis)</span>
<span id="cb21-2"><a href="#cb21-2"></a>L &lt;-<span class="st"> </span><span class="kw">makeContrast</span>(<span class="st">&quot;prognosisPD=0&quot;</span>, <span class="dt">parameterNames =</span> <span class="kw">c</span>(<span class="st">&quot;prognosisPD&quot;</span>))</span>
<span id="cb21-3"><a href="#cb21-3"></a>pe &lt;-<span class="st"> </span><span class="kw">hypothesisTest</span>(<span class="dt">object =</span> pe, <span class="dt">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="dt">contrast =</span> L)</span></code></pre></div>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1"></a>volcano3x3 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>prognosisPD <span class="op">%&gt;%</span><span class="st"> </span>na.exclude,</span>
<span id="cb22-2"><a href="#cb22-2"></a>                  <span class="kw">aes</span>(<span class="dt">x =</span> logFC, <span class="dt">y =</span> <span class="op">-</span><span class="kw">log10</span>(pval), <span class="dt">color =</span> adjPval <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)) <span class="op">+</span></span>
<span id="cb22-3"><a href="#cb22-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb22-4"><a href="#cb22-4"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">alpha</span>(<span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb22-5"><a href="#cb22-5"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb22-6"><a href="#cb22-6"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste0</span>(<span class="kw">sum</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>prognosisPD<span class="op">$</span>adjPval<span class="op">&lt;</span><span class="fl">0.05</span>,<span class="dt">na.rm=</span><span class="ot">TRUE</span>),<span class="st">&quot; proteins are found to be DA&quot;</span>))</span></code></pre></div>
</p>
</details>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1"></a>volcano3x3</span></code></pre></div>
<p><img src="experimentalDesign_files/figure-html/unnamed-chunk-19-1.png" width="672" /></p>
<p>Upon correction for multiple testing with using the false discovery rate (FDR) method no proteins are found to be differentially expressed.</p>
<p>Note, that you can refresh the concept of multiple testing and FDR [here] (<a href="https://statomics.github.io/PDA21/pda_quantification_inference.html#14_Multiple_hypothesis_testing" class="uri">https://statomics.github.io/PDA21/pda_quantification_inference.html#14_Multiple_hypothesis_testing</a>).</p>
</div>
<div id="experiment-with-a-6-vs-6-comparison" class="section level2">
<h2><span class="header-section-number">2.5</span> Experiment with a 6 vs 6 comparison</h2>
<div id="read-data-1" class="section level3">
<h3><span class="header-section-number">2.5.1</span> Read data</h3>
<details>
<summary> Click to see background and code </summary>
<p>
<ol style="list-style-type: decimal">
<li>We use a peptides.txt file from MS-data quantified with maxquant that contains MS1 intensities summarized at the peptide level.</li>
</ol>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1"></a>peptidesFile &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/statOmics/pda21/data/quantification/cancer/peptides6vs6.txt&quot;</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Maxquant stores the intensity data for the different samples in columnns that start with Intensity. We can retreive the column names with the intensity data with the code below:</li>
</ol>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1"></a>ecols &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;Intensity</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="kw">names</span>(<span class="kw">read.delim</span>(peptidesFile)))</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Read the data and store it in QFeatures object</li>
</ol>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1"></a>pe &lt;-<span class="st"> </span><span class="kw">readQFeatures</span>(</span>
<span id="cb26-2"><a href="#cb26-2"></a>  <span class="dt">table =</span> peptidesFile,</span>
<span id="cb26-3"><a href="#cb26-3"></a>  <span class="dt">fnames =</span> <span class="dv">1</span>,</span>
<span id="cb26-4"><a href="#cb26-4"></a>  <span class="dt">ecol =</span> ecols,</span>
<span id="cb26-5"><a href="#cb26-5"></a>  <span class="dt">name =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</span></code></pre></div>
</p>
</details>
</div>
<div id="design-1" class="section level3">
<h3><span class="header-section-number">2.5.2</span> Design</h3>
<details>
<summary> Click to see background and code </summary>
<p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1"></a>pe <span class="op">%&gt;%</span><span class="st"> </span>colnames</span></code></pre></div>
<pre><code>## CharacterList of length 1
## [[&quot;peptideRaw&quot;]] Intensity.OR.01 Intensity.OR.04 ... Intensity.PD.08</code></pre>
<ul>
<li>Note, that the sample names the outcome.</li>
<li>We update the colData with information on the design</li>
</ul>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1"></a><span class="kw">colData</span>(pe)<span class="op">$</span>prognosis &lt;-<span class="st">  </span>pe[[<span class="st">&quot;peptideRaw&quot;</span>]] <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb29-2"><a href="#cb29-2"></a><span class="st">  </span>colnames <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb29-3"><a href="#cb29-3"></a><span class="st">  </span><span class="kw">substr</span>(<span class="dv">11</span>,<span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb29-4"><a href="#cb29-4"></a><span class="st">  </span>as.factor</span></code></pre></div>
<ul>
<li>We explore the colData</li>
</ul>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1"></a><span class="kw">colData</span>(pe)</span></code></pre></div>
<pre><code>## DataFrame with 12 rows and 1 column
##                 prognosis
##                  &lt;factor&gt;
## Intensity.OR.01        OR
## Intensity.OR.04        OR
## Intensity.OR.07        OR
## Intensity.OR.09        OR
## Intensity.OR.10        OR
## ...                   ...
## Intensity.PD.03        PD
## Intensity.PD.04        PD
## Intensity.PD.06        PD
## Intensity.PD.07        PD
## Intensity.PD.08        PD</code></pre>
</p>
</details>
</div>
<div id="preprocessing-1" class="section level3">
<h3><span class="header-section-number">2.5.3</span> Preprocessing</h3>
<details>
<summary> Click to see code for preprocessing </summary>
<p>
<ol style="list-style-type: decimal">
<li>Log-transform</li>
</ol>
<ul>
<li>We calculate how many non zero intensities we have for each peptide and this can be useful for filtering.</li>
</ul>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="#cb32-1"></a><span class="kw">rowData</span>(pe[[<span class="st">&quot;peptideRaw&quot;</span>]])<span class="op">$</span>nNonZero &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">assay</span>(pe[[<span class="st">&quot;peptideRaw&quot;</span>]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<ul>
<li>Peptides with zero intensities are missing peptides and should be represent with a <code>NA</code> value rather than <code>0</code>.</li>
</ul>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="#cb33-1"></a>pe &lt;-<span class="st"> </span><span class="kw">zeroIsNA</span>(pe, <span class="st">&quot;peptideRaw&quot;</span>) <span class="co"># convert 0 to NA</span></span></code></pre></div>
<ul>
<li>Logtransform data with base 2</li>
</ul>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="#cb34-1"></a>pe &lt;-<span class="st"> </span><span class="kw">logTransform</span>(pe, <span class="dt">base =</span> <span class="dv">2</span>, <span class="dt">i =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="dt">name =</span> <span class="st">&quot;peptideLog&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Filtering</li>
</ol>
<details>
<summary> Click to see code to filter the data </summary>
<p>
<ul>
<li>Handling overlapping protein groups</li>
</ul>
<p>In our approach a peptide can map to multiple proteins, as long as there is none of these proteins present in a smaller subgroup.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="#cb35-1"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe, <span class="op">~</span><span class="st"> </span>Proteins <span class="op">%in%</span><span class="st"> </span><span class="kw">smallestUniqueGroups</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;peptideLog&quot;</span>]])<span class="op">$</span>Proteins))</span></code></pre></div>
<ul>
<li>Remove reverse sequences (decoys) and contaminants</li>
</ul>
<p>We now remove the contaminants, peptides that map to decoy sequences, and proteins which were only identified by peptides with modifications.</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="#cb36-1"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe,<span class="op">~</span>Reverse <span class="op">!=</span><span class="st"> &quot;+&quot;</span>)</span>
<span id="cb36-2"><a href="#cb36-2"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe,<span class="op">~</span><span class="st"> </span>Contaminant <span class="op">!=</span><span class="st"> &quot;+&quot;</span>)</span></code></pre></div>
<ul>
<li>Drop peptides that were only identified in one sample</li>
</ul>
<p>We keep peptides that were observed at last twice.</p>
<div class="sourceCode" id="cb37"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb37-1"><a href="#cb37-1"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe,<span class="op">~</span><span class="st"> </span>nNonZero <span class="op">&gt;=</span><span class="dv">2</span>)</span>
<span id="cb37-2"><a href="#cb37-2"></a><span class="kw">nrow</span>(pe[[<span class="st">&quot;peptideLog&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 25452</code></pre>
<p>We keep 25452 peptides upon filtering.</p>
<ol start="3" style="list-style-type: decimal">
<li>Normalization</li>
</ol>
<div class="sourceCode" id="cb39"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb39-1"><a href="#cb39-1"></a>pe &lt;-<span class="st"> </span><span class="kw">normalize</span>(pe, </span>
<span id="cb39-2"><a href="#cb39-2"></a>                <span class="dt">i =</span> <span class="st">&quot;peptideLog&quot;</span>, </span>
<span id="cb39-3"><a href="#cb39-3"></a>                <span class="dt">name =</span> <span class="st">&quot;peptideNorm&quot;</span>, </span>
<span id="cb39-4"><a href="#cb39-4"></a>                <span class="dt">method =</span> <span class="st">&quot;center.median&quot;</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Summarization</li>
</ol>
<div class="sourceCode" id="cb40"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb40-1"><a href="#cb40-1"></a>pe &lt;-<span class="st"> </span><span class="kw">aggregateFeatures</span>(pe,</span>
<span id="cb40-2"><a href="#cb40-2"></a>  <span class="dt">i =</span> <span class="st">&quot;peptideNorm&quot;</span>,</span>
<span id="cb40-3"><a href="#cb40-3"></a>  <span class="dt">fcol =</span> <span class="st">&quot;Proteins&quot;</span>,</span>
<span id="cb40-4"><a href="#cb40-4"></a>  <span class="dt">na.rm =</span> <span class="ot">TRUE</span>,</span>
<span id="cb40-5"><a href="#cb40-5"></a>  <span class="dt">name =</span> <span class="st">&quot;protein&quot;</span>)</span></code></pre></div>
</p>
</details>
</div>
<div id="statistical-inference-1" class="section level3">
<h3><span class="header-section-number">2.5.4</span> Statistical Inference</h3>
<details>
<summary> Click to see code to inference </summary>
<p>
<div class="sourceCode" id="cb41"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb41-1"><a href="#cb41-1"></a>pe &lt;-<span class="st"> </span><span class="kw">msqrob</span>(<span class="dt">object =</span> pe, <span class="dt">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="dt">formula =</span> <span class="op">~</span>prognosis)</span>
<span id="cb41-2"><a href="#cb41-2"></a>L &lt;-<span class="st"> </span><span class="kw">makeContrast</span>(<span class="st">&quot;prognosisPD=0&quot;</span>, <span class="dt">parameterNames =</span> <span class="kw">c</span>(<span class="st">&quot;prognosisPD&quot;</span>))</span>
<span id="cb41-3"><a href="#cb41-3"></a>pe &lt;-<span class="st"> </span><span class="kw">hypothesisTest</span>(<span class="dt">object =</span> pe, <span class="dt">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="dt">contrast =</span> L)</span></code></pre></div>
<div class="sourceCode" id="cb42"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb42-1"><a href="#cb42-1"></a>volcano6x6 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>prognosisPD <span class="op">%&gt;%</span><span class="st"> </span>na.exclude,</span>
<span id="cb42-2"><a href="#cb42-2"></a>                  <span class="kw">aes</span>(<span class="dt">x =</span> logFC, <span class="dt">y =</span> <span class="op">-</span><span class="kw">log10</span>(pval), <span class="dt">color =</span> adjPval <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)) <span class="op">+</span></span>
<span id="cb42-3"><a href="#cb42-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb42-4"><a href="#cb42-4"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">alpha</span>(<span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb42-5"><a href="#cb42-5"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb42-6"><a href="#cb42-6"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste0</span>(<span class="kw">sum</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>prognosisPD<span class="op">$</span>adjPval<span class="op">&lt;</span><span class="fl">0.05</span>,<span class="dt">na.rm=</span><span class="ot">TRUE</span>),<span class="st">&quot; proteins are found to be DA&quot;</span>))</span></code></pre></div>
</p>
</details>
<div class="sourceCode" id="cb43"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb43-1"><a href="#cb43-1"></a>volcano6x6</span></code></pre></div>
<p><img src="experimentalDesign_files/figure-html/unnamed-chunk-36-1.png" width="672" /></p>
</div>
</div>
<div id="experiment-with-a-9-vs-9-comparison" class="section level2">
<h2><span class="header-section-number">2.6</span> Experiment with a 9 vs 9 comparison</h2>
<div id="read-data-2" class="section level3">
<h3><span class="header-section-number">2.6.1</span> Read data</h3>
<details>
<summary> Click to see background and code </summary>
<p>
<ol style="list-style-type: decimal">
<li>We use a peptides.txt file from MS-data quantified with maxquant that contains MS1 intensities summarized at the peptide level.</li>
</ol>
<div class="sourceCode" id="cb44"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb44-1"><a href="#cb44-1"></a>peptidesFile &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/statOmics/pda21/data/quantification/cancer/peptides9vs9.txt&quot;</span></span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Maxquant stores the intensity data for the different samples in columnns that start with Intensity. We can retreive the column names with the intensity data with the code below:</li>
</ol>
<div class="sourceCode" id="cb45"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb45-1"><a href="#cb45-1"></a>ecols &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;Intensity</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="kw">names</span>(<span class="kw">read.delim</span>(peptidesFile)))</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Read the data and store it in QFeatures object</li>
</ol>
<div class="sourceCode" id="cb46"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb46-1"><a href="#cb46-1"></a>pe &lt;-<span class="st"> </span><span class="kw">readQFeatures</span>(</span>
<span id="cb46-2"><a href="#cb46-2"></a>  <span class="dt">table =</span> peptidesFile,</span>
<span id="cb46-3"><a href="#cb46-3"></a>  <span class="dt">fnames =</span> <span class="dv">1</span>,</span>
<span id="cb46-4"><a href="#cb46-4"></a>  <span class="dt">ecol =</span> ecols,</span>
<span id="cb46-5"><a href="#cb46-5"></a>  <span class="dt">name =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</span></code></pre></div>
</p>
</details>
</div>
<div id="design-2" class="section level3">
<h3><span class="header-section-number">2.6.2</span> Design</h3>
<details>
<summary> Click to see background and code </summary>
<p>
<div class="sourceCode" id="cb47"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb47-1"><a href="#cb47-1"></a>pe <span class="op">%&gt;%</span><span class="st"> </span>colnames</span></code></pre></div>
<pre><code>## CharacterList of length 1
## [[&quot;peptideRaw&quot;]] Intensity.OR.01 Intensity.OR.04 ... Intensity.PD.11</code></pre>
<ul>
<li>Note, that the sample names the outcome.</li>
<li>We update the colData with information on the design</li>
</ul>
<div class="sourceCode" id="cb49"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb49-1"><a href="#cb49-1"></a><span class="kw">colData</span>(pe)<span class="op">$</span>prognosis &lt;-<span class="st">  </span>pe[[<span class="st">&quot;peptideRaw&quot;</span>]] <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-2"><a href="#cb49-2"></a><span class="st">  </span>colnames <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-3"><a href="#cb49-3"></a><span class="st">  </span><span class="kw">substr</span>(<span class="dv">11</span>,<span class="dv">12</span>) <span class="op">%&gt;%</span><span class="st"> </span></span>
<span id="cb49-4"><a href="#cb49-4"></a><span class="st">  </span>as.factor</span></code></pre></div>
<ul>
<li>We explore the colData</li>
</ul>
<div class="sourceCode" id="cb50"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb50-1"><a href="#cb50-1"></a><span class="kw">colData</span>(pe)</span></code></pre></div>
<pre><code>## DataFrame with 18 rows and 1 column
##                 prognosis
##                  &lt;factor&gt;
## Intensity.OR.01        OR
## Intensity.OR.04        OR
## Intensity.OR.07        OR
## Intensity.OR.09        OR
## Intensity.OR.10        OR
## ...                   ...
## Intensity.PD.07        PD
## Intensity.PD.08        PD
## Intensity.PD.09        PD
## Intensity.PD.10        PD
## Intensity.PD.11        PD</code></pre>
</p>
</details>
</div>
<div id="preprocessing-2" class="section level3">
<h3><span class="header-section-number">2.6.3</span> Preprocessing</h3>
<details>
<summary> Click to see code for preprocessing </summary>
<p>
<ol style="list-style-type: decimal">
<li>Log-transform</li>
</ol>
<ul>
<li>We calculate how many non zero intensities we have for each peptide and this can be useful for filtering.</li>
</ul>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="#cb52-1"></a><span class="kw">rowData</span>(pe[[<span class="st">&quot;peptideRaw&quot;</span>]])<span class="op">$</span>nNonZero &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">assay</span>(pe[[<span class="st">&quot;peptideRaw&quot;</span>]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<ul>
<li>Peptides with zero intensities are missing peptides and should be represent with a <code>NA</code> value rather than <code>0</code>.</li>
</ul>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="#cb53-1"></a>pe &lt;-<span class="st"> </span><span class="kw">zeroIsNA</span>(pe, <span class="st">&quot;peptideRaw&quot;</span>) <span class="co"># convert 0 to NA</span></span></code></pre></div>
<ul>
<li>Logtransform data with base 2</li>
</ul>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="#cb54-1"></a>pe &lt;-<span class="st"> </span><span class="kw">logTransform</span>(pe, <span class="dt">base =</span> <span class="dv">2</span>, <span class="dt">i =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="dt">name =</span> <span class="st">&quot;peptideLog&quot;</span>)</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Filtering</li>
</ol>
<details>
<summary> Click to see code to filter the data </summary>
<p>
<ul>
<li>Handling overlapping protein groups</li>
</ul>
<p>In our approach a peptide can map to multiple proteins, as long as there is none of these proteins present in a smaller subgroup.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="#cb55-1"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe, <span class="op">~</span><span class="st"> </span>Proteins <span class="op">%in%</span><span class="st"> </span><span class="kw">smallestUniqueGroups</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;peptideLog&quot;</span>]])<span class="op">$</span>Proteins))</span></code></pre></div>
<ul>
<li>Remove reverse sequences (decoys) and contaminants</li>
</ul>
<p>We now remove the contaminants, peptides that map to decoy sequences, and proteins which were only identified by peptides with modifications.</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="#cb56-1"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe,<span class="op">~</span>Reverse <span class="op">!=</span><span class="st"> &quot;+&quot;</span>)</span>
<span id="cb56-2"><a href="#cb56-2"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe,<span class="op">~</span><span class="st"> </span>Contaminant <span class="op">!=</span><span class="st"> &quot;+&quot;</span>)</span></code></pre></div>
<ul>
<li>Drop peptides that were only identified in one sample</li>
</ul>
<p>We keep peptides that were observed at last twice.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="#cb57-1"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe,<span class="op">~</span><span class="st"> </span>nNonZero <span class="op">&gt;=</span><span class="dv">2</span>)</span>
<span id="cb57-2"><a href="#cb57-2"></a><span class="kw">nrow</span>(pe[[<span class="st">&quot;peptideLog&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 26696</code></pre>
<p>We keep 26696 peptides upon filtering.</p>
<ol start="3" style="list-style-type: decimal">
<li>Normalization</li>
</ol>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="#cb59-1"></a>pe &lt;-<span class="st"> </span><span class="kw">normalize</span>(pe, </span>
<span id="cb59-2"><a href="#cb59-2"></a>                <span class="dt">i =</span> <span class="st">&quot;peptideLog&quot;</span>, </span>
<span id="cb59-3"><a href="#cb59-3"></a>                <span class="dt">name =</span> <span class="st">&quot;peptideNorm&quot;</span>, </span>
<span id="cb59-4"><a href="#cb59-4"></a>                <span class="dt">method =</span> <span class="st">&quot;center.median&quot;</span>)</span></code></pre></div>
<ol start="4" style="list-style-type: decimal">
<li>Summarization</li>
</ol>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="#cb60-1"></a>pe &lt;-<span class="st"> </span><span class="kw">aggregateFeatures</span>(pe,</span>
<span id="cb60-2"><a href="#cb60-2"></a>  <span class="dt">i =</span> <span class="st">&quot;peptideNorm&quot;</span>,</span>
<span id="cb60-3"><a href="#cb60-3"></a>  <span class="dt">fcol =</span> <span class="st">&quot;Proteins&quot;</span>,</span>
<span id="cb60-4"><a href="#cb60-4"></a>  <span class="dt">na.rm =</span> <span class="ot">TRUE</span>,</span>
<span id="cb60-5"><a href="#cb60-5"></a>  <span class="dt">name =</span> <span class="st">&quot;protein&quot;</span>)</span></code></pre></div>
</p>
</details>
</div>
<div id="statistical-inference-2" class="section level3">
<h3><span class="header-section-number">2.6.4</span> Statistical Inference</h3>
<details>
<summary> Click to see code to inference </summary>
<p>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="#cb61-1"></a>pe &lt;-<span class="st"> </span><span class="kw">msqrob</span>(<span class="dt">object =</span> pe, <span class="dt">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="dt">formula =</span> <span class="op">~</span>prognosis)</span>
<span id="cb61-2"><a href="#cb61-2"></a>L &lt;-<span class="st"> </span><span class="kw">makeContrast</span>(<span class="st">&quot;prognosisPD=0&quot;</span>, <span class="dt">parameterNames =</span> <span class="kw">c</span>(<span class="st">&quot;prognosisPD&quot;</span>))</span>
<span id="cb61-3"><a href="#cb61-3"></a>pe &lt;-<span class="st"> </span><span class="kw">hypothesisTest</span>(<span class="dt">object =</span> pe, <span class="dt">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="dt">contrast =</span> L)</span></code></pre></div>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="#cb62-1"></a>volcano9x9 &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>prognosisPD <span class="op">%&gt;%</span><span class="st"> </span>na.exclude,</span>
<span id="cb62-2"><a href="#cb62-2"></a>                  <span class="kw">aes</span>(<span class="dt">x =</span> logFC, <span class="dt">y =</span> <span class="op">-</span><span class="kw">log10</span>(pval), <span class="dt">color =</span> adjPval <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)) <span class="op">+</span></span>
<span id="cb62-3"><a href="#cb62-3"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb62-4"><a href="#cb62-4"></a><span class="st">  </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">alpha</span>(<span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="op">+</span><span class="st"> </span></span>
<span id="cb62-5"><a href="#cb62-5"></a><span class="st">  </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb62-6"><a href="#cb62-6"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="kw">paste0</span>(<span class="kw">sum</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>prognosisPD<span class="op">$</span>adjPval<span class="op">&lt;</span><span class="fl">0.05</span>,<span class="dt">na.rm=</span><span class="ot">TRUE</span>),<span class="st">&quot; proteins are found to be DA&quot;</span>))</span></code></pre></div>
</p>
</details>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="#cb63-1"></a>volcano9x9</span></code></pre></div>
<p><img src="experimentalDesign_files/figure-html/unnamed-chunk-53-1.png" width="672" /></p>
<ul>
<li><p>We have seen that the sample size is key to recover DA proteins</p></li>
<li><p>Indeed, if a protein is differentially expressed, the value of T-test depends on the effect size, the variability of the protein expression values and the sample size.</p></li>
</ul>
<p><span class="math display">\[
T_g=\frac{\log_2 \text{FC}}{\text{se}_{\log_2 \text{FC}}}
\]</span></p>
<p><span class="math display">\[
T_g=\frac{\widehat{\text{signal}}}{\widehat{\text{Noise}}}
\]</span></p>
<p>For a two group comparison the standard error on the fold change equals</p>
<p><span class="math display">\[
\text{se}_{\log_2 \text{FC}}=\text{SD}\sqrt{\frac{1}{n_1}+\frac{1}{n_2}}
\]</span></p>
<p><span class="math inline">\(\rightarrow\)</span> if number of bio-repeats increases we have a higher power!</p>
</div>
</div>
</div>
<div id="randomized-complete-block-designs" class="section level1">
<h1><span class="header-section-number">3</span> Randomized complete block designs</h1>
<p><span class="math display">\[\sigma^2= \sigma^2_{bio}+\sigma^2_\text{lab} +\sigma^2_\text{extraction} + \sigma^2_\text{run} + \ldots\]</span></p>
<ul>
<li>Biological: fluctuations in protein level between mice, fluctations in protein level between cells, …</li>
<li>Technical: cage effect, lab effect, week effect, plasma extraction, MS-run, …</li>
</ul>
<div id="nature-methods-points-of-significance---blocking" class="section level2">
<h2><span class="header-section-number">3.1</span> Nature methods: Points of significance - Blocking</h2>
<p><a href="https://www.nature.com/articles/nmeth.3005.pdf">https://www.nature.com/articles/nmeth.3005.pdf</a></p>
</div>
<div id="mouse-example" class="section level2">
<h2><span class="header-section-number">3.2</span> Mouse example</h2>
<p><img src="figures/mouseTcell_RCB_design.png" width="50%" /></p>
<p>Duguet et al. (2017) MCP 16(8):1416-1432. doi: 10.1074/mcp.m116.062745</p>
<ul>
<li>All treatments of interest are present within block!</li>
<li>We can estimate the effect of the treatment within block!</li>
</ul>
<p>To illustrate the power of blocking we have subsetted the data of Duguet et al. in a</p>
<ul>
<li><p>completely randomized design with</p>
<ul>
<li>four mice for which we only have measurements on the ordinary T-cells</li>
<li>four mice for which we only have measurements on the regulatory T-cells</li>
</ul></li>
<li><p>randomized complete block design with four mice for which we both have</p>
<ul>
<li>measurements on ordinary T-cells as well as</li>
<li>measurements on regulatory T-cells</li>
</ul></li>
</ul>
<div id="data" class="section level3">
<h3><span class="header-section-number">3.2.1</span> Data</h3>
<details>
<summary> Click to see code </summary>
<p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="#cb64-1"></a><span class="kw">library</span>(tidyverse)</span>
<span id="cb64-2"><a href="#cb64-2"></a><span class="kw">library</span>(limma)</span>
<span id="cb64-3"><a href="#cb64-3"></a><span class="kw">library</span>(QFeatures)</span>
<span id="cb64-4"><a href="#cb64-4"></a><span class="kw">library</span>(msqrob2)</span>
<span id="cb64-5"><a href="#cb64-5"></a><span class="kw">library</span>(plotly)</span>
<span id="cb64-6"><a href="#cb64-6"></a><span class="kw">library</span>(gridExtra)</span>
<span id="cb64-7"><a href="#cb64-7"></a></span>
<span id="cb64-8"><a href="#cb64-8"></a>peptidesFile &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/statOmics/PDA21/data/quantification/mouseTcell/peptidesRCB.txt&quot;</span></span>
<span id="cb64-9"><a href="#cb64-9"></a>peptidesFile2 &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/statOmics/PDA21/data/quantification/mouseTcell/peptidesCRD.txt&quot;</span></span>
<span id="cb64-10"><a href="#cb64-10"></a>peptidesFile3 &lt;-<span class="st"> &quot;https://raw.githubusercontent.com/statOmics/PDA21/data/quantification/mouseTcell/peptides.txt&quot;</span></span>
<span id="cb64-11"><a href="#cb64-11"></a></span>
<span id="cb64-12"><a href="#cb64-12"></a>ecols &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;Intensity</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="kw">names</span>(<span class="kw">read.delim</span>(peptidesFile)))</span>
<span id="cb64-13"><a href="#cb64-13"></a>pe &lt;-<span class="st"> </span><span class="kw">readQFeatures</span>(</span>
<span id="cb64-14"><a href="#cb64-14"></a>  <span class="dt">table =</span> peptidesFile,</span>
<span id="cb64-15"><a href="#cb64-15"></a>  <span class="dt">fnames =</span> <span class="dv">1</span>,</span>
<span id="cb64-16"><a href="#cb64-16"></a>  <span class="dt">ecol =</span> ecols,</span>
<span id="cb64-17"><a href="#cb64-17"></a>  <span class="dt">name =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</span>
<span id="cb64-18"><a href="#cb64-18"></a></span>
<span id="cb64-19"><a href="#cb64-19"></a>ecols2 &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;Intensity</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="kw">names</span>(<span class="kw">read.delim</span>(peptidesFile2)))</span>
<span id="cb64-20"><a href="#cb64-20"></a>pe2 &lt;-<span class="st"> </span><span class="kw">readQFeatures</span>(</span>
<span id="cb64-21"><a href="#cb64-21"></a>  <span class="dt">table =</span> peptidesFile2,</span>
<span id="cb64-22"><a href="#cb64-22"></a>  <span class="dt">fnames =</span> <span class="dv">1</span>,</span>
<span id="cb64-23"><a href="#cb64-23"></a>  <span class="dt">ecol =</span> ecols2,</span>
<span id="cb64-24"><a href="#cb64-24"></a>  <span class="dt">name =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</span>
<span id="cb64-25"><a href="#cb64-25"></a></span>
<span id="cb64-26"><a href="#cb64-26"></a>ecols3 &lt;-<span class="st"> </span><span class="kw">grep</span>(<span class="st">&quot;Intensity</span><span class="ch">\\</span><span class="st">.&quot;</span>, <span class="kw">names</span>(<span class="kw">read.delim</span>(peptidesFile3)))</span>
<span id="cb64-27"><a href="#cb64-27"></a>pe3 &lt;-<span class="st"> </span><span class="kw">readQFeatures</span>(</span>
<span id="cb64-28"><a href="#cb64-28"></a>  <span class="dt">table =</span> peptidesFile3,</span>
<span id="cb64-29"><a href="#cb64-29"></a>  <span class="dt">fnames =</span> <span class="dv">1</span>,</span>
<span id="cb64-30"><a href="#cb64-30"></a>  <span class="dt">ecol =</span> ecols3,</span>
<span id="cb64-31"><a href="#cb64-31"></a>  <span class="dt">name =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="dt">sep=</span><span class="st">&quot;</span><span class="ch">\t</span><span class="st">&quot;</span>)</span>
<span id="cb64-32"><a href="#cb64-32"></a></span>
<span id="cb64-33"><a href="#cb64-33"></a><span class="co">### Design</span></span>
<span id="cb64-34"><a href="#cb64-34"></a><span class="kw">colData</span>(pe)<span class="op">$</span>celltype &lt;-<span class="st"> </span><span class="kw">substr</span>(</span>
<span id="cb64-35"><a href="#cb64-35"></a>  <span class="kw">colnames</span>(pe[[<span class="st">&quot;peptideRaw&quot;</span>]]),</span>
<span id="cb64-36"><a href="#cb64-36"></a>  <span class="dv">11</span>,</span>
<span id="cb64-37"><a href="#cb64-37"></a>  <span class="dv">14</span>) <span class="op">%&gt;%</span></span>
<span id="cb64-38"><a href="#cb64-38"></a><span class="st">  </span>unlist <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb64-39"><a href="#cb64-39"></a><span class="st">  </span>as.factor</span>
<span id="cb64-40"><a href="#cb64-40"></a></span>
<span id="cb64-41"><a href="#cb64-41"></a><span class="kw">colData</span>(pe)<span class="op">$</span>mouse &lt;-<span class="st"> </span>pe[[<span class="dv">1</span>]] <span class="op">%&gt;%</span></span>
<span id="cb64-42"><a href="#cb64-42"></a><span class="st">  </span>colnames <span class="op">%&gt;%</span></span>
<span id="cb64-43"><a href="#cb64-43"></a><span class="st">  </span><span class="kw">strsplit</span>(<span class="dt">split=</span><span class="st">&quot;[.]&quot;</span>)  <span class="op">%&gt;%</span></span>
<span id="cb64-44"><a href="#cb64-44"></a><span class="st">  </span><span class="kw">sapply</span>(<span class="cf">function</span>(x) x[<span class="dv">3</span>]) <span class="op">%&gt;%</span></span>
<span id="cb64-45"><a href="#cb64-45"></a><span class="st">  </span>as.factor</span>
<span id="cb64-46"><a href="#cb64-46"></a></span>
<span id="cb64-47"><a href="#cb64-47"></a><span class="kw">colData</span>(pe2)<span class="op">$</span>celltype &lt;-<span class="st"> </span><span class="kw">substr</span>(</span>
<span id="cb64-48"><a href="#cb64-48"></a>  <span class="kw">colnames</span>(pe2[[<span class="st">&quot;peptideRaw&quot;</span>]]),</span>
<span id="cb64-49"><a href="#cb64-49"></a>  <span class="dv">11</span>,</span>
<span id="cb64-50"><a href="#cb64-50"></a>  <span class="dv">14</span>) <span class="op">%&gt;%</span></span>
<span id="cb64-51"><a href="#cb64-51"></a><span class="st">  </span>unlist <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb64-52"><a href="#cb64-52"></a><span class="st">  </span>as.factor</span>
<span id="cb64-53"><a href="#cb64-53"></a></span>
<span id="cb64-54"><a href="#cb64-54"></a><span class="kw">colData</span>(pe2)<span class="op">$</span>mouse &lt;-<span class="st"> </span>pe2[[<span class="dv">1</span>]] <span class="op">%&gt;%</span></span>
<span id="cb64-55"><a href="#cb64-55"></a><span class="st">  </span>colnames <span class="op">%&gt;%</span></span>
<span id="cb64-56"><a href="#cb64-56"></a><span class="st">  </span><span class="kw">strsplit</span>(<span class="dt">split=</span><span class="st">&quot;[.]&quot;</span>)  <span class="op">%&gt;%</span></span>
<span id="cb64-57"><a href="#cb64-57"></a><span class="st">  </span><span class="kw">sapply</span>(<span class="cf">function</span>(x) x[<span class="dv">3</span>]) <span class="op">%&gt;%</span></span>
<span id="cb64-58"><a href="#cb64-58"></a><span class="st">  </span>as.factor</span>
<span id="cb64-59"><a href="#cb64-59"></a></span>
<span id="cb64-60"><a href="#cb64-60"></a><span class="kw">colData</span>(pe3)<span class="op">$</span>celltype &lt;-<span class="st"> </span><span class="kw">substr</span>(</span>
<span id="cb64-61"><a href="#cb64-61"></a>  <span class="kw">colnames</span>(pe3[[<span class="st">&quot;peptideRaw&quot;</span>]]),</span>
<span id="cb64-62"><a href="#cb64-62"></a>  <span class="dv">11</span>,</span>
<span id="cb64-63"><a href="#cb64-63"></a>  <span class="dv">14</span>) <span class="op">%&gt;%</span></span>
<span id="cb64-64"><a href="#cb64-64"></a><span class="st">  </span>unlist <span class="op">%&gt;%</span><span class="st">  </span></span>
<span id="cb64-65"><a href="#cb64-65"></a><span class="st">  </span>as.factor</span>
<span id="cb64-66"><a href="#cb64-66"></a></span>
<span id="cb64-67"><a href="#cb64-67"></a><span class="kw">colData</span>(pe3)<span class="op">$</span>mouse &lt;-<span class="st"> </span>pe3[[<span class="dv">1</span>]] <span class="op">%&gt;%</span></span>
<span id="cb64-68"><a href="#cb64-68"></a><span class="st">  </span>colnames <span class="op">%&gt;%</span></span>
<span id="cb64-69"><a href="#cb64-69"></a><span class="st">  </span><span class="kw">strsplit</span>(<span class="dt">split=</span><span class="st">&quot;[.]&quot;</span>)  <span class="op">%&gt;%</span></span>
<span id="cb64-70"><a href="#cb64-70"></a><span class="st">  </span><span class="kw">sapply</span>(<span class="cf">function</span>(x) x[<span class="dv">3</span>]) <span class="op">%&gt;%</span></span>
<span id="cb64-71"><a href="#cb64-71"></a><span class="st">  </span>as.factor</span></code></pre></div>
</p>
<p></design></p>
</div>
<div id="preprocessing-3" class="section level3">
<h3><span class="header-section-number">3.2.2</span> Preprocessing</h3>
<div id="log-transform" class="section level4">
<h4><span class="header-section-number">3.2.2.1</span> Log-transform</h4>
<details>
<summary> Click to see code to log-transfrom the data </summary>
<p>
<ul>
<li>We calculate how many non zero intensities we have for each peptide and this can be useful for filtering.</li>
</ul>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="#cb65-1"></a><span class="kw">rowData</span>(pe[[<span class="st">&quot;peptideRaw&quot;</span>]])<span class="op">$</span>nNonZero &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">assay</span>(pe[[<span class="st">&quot;peptideRaw&quot;</span>]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb65-2"><a href="#cb65-2"></a></span>
<span id="cb65-3"><a href="#cb65-3"></a><span class="kw">rowData</span>(pe2[[<span class="st">&quot;peptideRaw&quot;</span>]])<span class="op">$</span>nNonZero &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">assay</span>(pe2[[<span class="st">&quot;peptideRaw&quot;</span>]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span>
<span id="cb65-4"><a href="#cb65-4"></a></span>
<span id="cb65-5"><a href="#cb65-5"></a><span class="kw">rowData</span>(pe3[[<span class="st">&quot;peptideRaw&quot;</span>]])<span class="op">$</span>nNonZero &lt;-<span class="st"> </span><span class="kw">rowSums</span>(<span class="kw">assay</span>(pe3[[<span class="st">&quot;peptideRaw&quot;</span>]]) <span class="op">&gt;</span><span class="st"> </span><span class="dv">0</span>)</span></code></pre></div>
<ul>
<li>Peptides with zero intensities are missing peptides and should be represent with a <code>NA</code> value rather than <code>0</code>.</li>
</ul>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="#cb66-1"></a>pe &lt;-<span class="st"> </span><span class="kw">zeroIsNA</span>(pe, <span class="st">&quot;peptideRaw&quot;</span>) <span class="co"># convert 0 to NA</span></span>
<span id="cb66-2"><a href="#cb66-2"></a></span>
<span id="cb66-3"><a href="#cb66-3"></a>pe2 &lt;-<span class="st"> </span><span class="kw">zeroIsNA</span>(pe2, <span class="st">&quot;peptideRaw&quot;</span>) <span class="co"># convert 0 to NA</span></span>
<span id="cb66-4"><a href="#cb66-4"></a></span>
<span id="cb66-5"><a href="#cb66-5"></a>pe3 &lt;-<span class="st"> </span><span class="kw">zeroIsNA</span>(pe3, <span class="st">&quot;peptideRaw&quot;</span>) <span class="co"># convert 0 to NA</span></span></code></pre></div>
<ul>
<li>Logtransform data with base 2</li>
</ul>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="#cb67-1"></a>pe &lt;-<span class="st"> </span><span class="kw">logTransform</span>(pe, <span class="dt">base =</span> <span class="dv">2</span>, <span class="dt">i =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="dt">name =</span> <span class="st">&quot;peptideLog&quot;</span>)</span>
<span id="cb67-2"><a href="#cb67-2"></a></span>
<span id="cb67-3"><a href="#cb67-3"></a>pe2 &lt;-<span class="st"> </span><span class="kw">logTransform</span>(pe2, <span class="dt">base =</span> <span class="dv">2</span>, <span class="dt">i =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="dt">name =</span> <span class="st">&quot;peptideLog&quot;</span>)</span>
<span id="cb67-4"><a href="#cb67-4"></a></span>
<span id="cb67-5"><a href="#cb67-5"></a>pe3 &lt;-<span class="st"> </span><span class="kw">logTransform</span>(pe3, <span class="dt">base =</span> <span class="dv">2</span>, <span class="dt">i =</span> <span class="st">&quot;peptideRaw&quot;</span>, <span class="dt">name =</span> <span class="st">&quot;peptideLog&quot;</span>)</span></code></pre></div>
</p>
</details>
</div>
<div id="filtering" class="section level4">
<h4><span class="header-section-number">3.2.2.2</span> Filtering</h4>
<details>
<summary> Click to see details on filtering </summary>
<p>
<ol style="list-style-type: decimal">
<li>Handling overlapping protein groups</li>
</ol>
<p>In our approach a peptide can map to multiple proteins, as long as there is none of these proteins present in a smaller subgroup.</p>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="#cb68-1"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe, <span class="op">~</span><span class="st"> </span>Proteins <span class="op">%in%</span><span class="st"> </span><span class="kw">smallestUniqueGroups</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;peptideLog&quot;</span>]])<span class="op">$</span>Proteins))</span>
<span id="cb68-2"><a href="#cb68-2"></a></span>
<span id="cb68-3"><a href="#cb68-3"></a>pe2 &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe2, <span class="op">~</span><span class="st"> </span>Proteins <span class="op">%in%</span><span class="st"> </span><span class="kw">smallestUniqueGroups</span>(<span class="kw">rowData</span>(pe2[[<span class="st">&quot;peptideLog&quot;</span>]])<span class="op">$</span>Proteins))</span>
<span id="cb68-4"><a href="#cb68-4"></a></span>
<span id="cb68-5"><a href="#cb68-5"></a>pe3 &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe3, <span class="op">~</span><span class="st"> </span>Proteins <span class="op">%in%</span><span class="st"> </span><span class="kw">smallestUniqueGroups</span>(<span class="kw">rowData</span>(pe3[[<span class="st">&quot;peptideLog&quot;</span>]])<span class="op">$</span>Proteins))</span></code></pre></div>
<ol start="2" style="list-style-type: decimal">
<li>Remove reverse sequences (decoys) and contaminants</li>
</ol>
<p>We now remove the contaminants, peptides that map to decoy sequences, and proteins which were only identified by peptides with modifications.</p>
<div class="sourceCode" id="cb69"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb69-1"><a href="#cb69-1"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe,<span class="op">~</span>Reverse <span class="op">!=</span><span class="st"> &quot;+&quot;</span>)</span>
<span id="cb69-2"><a href="#cb69-2"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe,<span class="op">~</span><span class="st"> </span>Potential.contaminant <span class="op">!=</span><span class="st"> &quot;+&quot;</span>)</span>
<span id="cb69-3"><a href="#cb69-3"></a></span>
<span id="cb69-4"><a href="#cb69-4"></a>pe2 &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe2,<span class="op">~</span>Reverse <span class="op">!=</span><span class="st"> &quot;+&quot;</span>)</span>
<span id="cb69-5"><a href="#cb69-5"></a>pe2 &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe2,<span class="op">~</span><span class="st"> </span>Potential.contaminant <span class="op">!=</span><span class="st"> &quot;+&quot;</span>)</span>
<span id="cb69-6"><a href="#cb69-6"></a></span>
<span id="cb69-7"><a href="#cb69-7"></a>pe3 &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe3,<span class="op">~</span>Reverse <span class="op">!=</span><span class="st"> &quot;+&quot;</span>)</span>
<span id="cb69-8"><a href="#cb69-8"></a>pe3 &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe3,<span class="op">~</span><span class="st"> </span>Potential.contaminant <span class="op">!=</span><span class="st"> &quot;+&quot;</span>)</span></code></pre></div>
<ol start="3" style="list-style-type: decimal">
<li>Drop peptides that were only identified in one sample</li>
</ol>
<p>We keep peptides that were observed at last twice.</p>
<div class="sourceCode" id="cb70"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb70-1"><a href="#cb70-1"></a>pe &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe,<span class="op">~</span><span class="st"> </span>nNonZero <span class="op">&gt;=</span><span class="dv">2</span>)</span>
<span id="cb70-2"><a href="#cb70-2"></a><span class="kw">nrow</span>(pe[[<span class="st">&quot;peptideLog&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 44449</code></pre>
<div class="sourceCode" id="cb72"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb72-1"><a href="#cb72-1"></a>pe2 &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe2,<span class="op">~</span><span class="st"> </span>nNonZero <span class="op">&gt;=</span><span class="dv">2</span>)</span>
<span id="cb72-2"><a href="#cb72-2"></a><span class="kw">nrow</span>(pe2[[<span class="st">&quot;peptideLog&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 43401</code></pre>
<div class="sourceCode" id="cb74"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb74-1"><a href="#cb74-1"></a>pe3 &lt;-<span class="st"> </span><span class="kw">filterFeatures</span>(pe3,<span class="op">~</span><span class="st"> </span>nNonZero <span class="op">&gt;=</span><span class="dv">2</span>)</span>
<span id="cb74-2"><a href="#cb74-2"></a><span class="kw">nrow</span>(pe3[[<span class="st">&quot;peptideLog&quot;</span>]])</span></code></pre></div>
<pre><code>## [1] 47431</code></pre>
</p>
</details>
</div>
<div id="normalization" class="section level4">
<h4><span class="header-section-number">3.2.2.3</span> Normalization</h4>
<details>
<summary> Click to see code to normalize the data </summary>
<p>
<div class="sourceCode" id="cb76"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb76-1"><a href="#cb76-1"></a>pe &lt;-<span class="st"> </span><span class="kw">normalize</span>(pe, </span>
<span id="cb76-2"><a href="#cb76-2"></a>                <span class="dt">i =</span> <span class="st">&quot;peptideLog&quot;</span>, </span>
<span id="cb76-3"><a href="#cb76-3"></a>                <span class="dt">name =</span> <span class="st">&quot;peptideNorm&quot;</span>, </span>
<span id="cb76-4"><a href="#cb76-4"></a>                <span class="dt">method =</span> <span class="st">&quot;center.median&quot;</span>)</span>
<span id="cb76-5"><a href="#cb76-5"></a></span>
<span id="cb76-6"><a href="#cb76-6"></a>pe2 &lt;-<span class="st"> </span><span class="kw">normalize</span>(pe2, </span>
<span id="cb76-7"><a href="#cb76-7"></a>                <span class="dt">i =</span> <span class="st">&quot;peptideLog&quot;</span>, </span>
<span id="cb76-8"><a href="#cb76-8"></a>                <span class="dt">name =</span> <span class="st">&quot;peptideNorm&quot;</span>, </span>
<span id="cb76-9"><a href="#cb76-9"></a>                <span class="dt">method =</span> <span class="st">&quot;center.median&quot;</span>)</span>
<span id="cb76-10"><a href="#cb76-10"></a></span>
<span id="cb76-11"><a href="#cb76-11"></a></span>
<span id="cb76-12"><a href="#cb76-12"></a>pe3 &lt;-<span class="st"> </span><span class="kw">normalize</span>(pe3, </span>
<span id="cb76-13"><a href="#cb76-13"></a>                <span class="dt">i =</span> <span class="st">&quot;peptideLog&quot;</span>, </span>
<span id="cb76-14"><a href="#cb76-14"></a>                <span class="dt">name =</span> <span class="st">&quot;peptideNorm&quot;</span>, </span>
<span id="cb76-15"><a href="#cb76-15"></a>                <span class="dt">method =</span> <span class="st">&quot;center.median&quot;</span>)</span></code></pre></div>
</p>
</details>
</div>
<div id="summarization" class="section level4">
<h4><span class="header-section-number">3.2.2.4</span> Summarization</h4>
<details>
<summary> Click to see code to summarize the data </summary>
<p>
<div class="sourceCode" id="cb77"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb77-1"><a href="#cb77-1"></a>pe &lt;-<span class="st"> </span><span class="kw">aggregateFeatures</span>(pe,</span>
<span id="cb77-2"><a href="#cb77-2"></a> <span class="dt">i =</span> <span class="st">&quot;peptideNorm&quot;</span>,</span>
<span id="cb77-3"><a href="#cb77-3"></a> <span class="dt">fcol =</span> <span class="st">&quot;Proteins&quot;</span>,</span>
<span id="cb77-4"><a href="#cb77-4"></a> <span class="dt">na.rm =</span> <span class="ot">TRUE</span>,</span>
<span id="cb77-5"><a href="#cb77-5"></a> <span class="dt">name =</span> <span class="st">&quot;protein&quot;</span>)</span></code></pre></div>
<pre><code>## Your quantitative and row data contain missing values. Please read the
## relevant section(s) in the aggregateFeatures manual page regarding the
## effects of missing values on data aggregation.</code></pre>
<div class="sourceCode" id="cb79"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb79-1"><a href="#cb79-1"></a>pe2 &lt;-<span class="st"> </span><span class="kw">aggregateFeatures</span>(pe2,</span>
<span id="cb79-2"><a href="#cb79-2"></a> <span class="dt">i =</span> <span class="st">&quot;peptideNorm&quot;</span>,</span>
<span id="cb79-3"><a href="#cb79-3"></a> <span class="dt">fcol =</span> <span class="st">&quot;Proteins&quot;</span>,</span>
<span id="cb79-4"><a href="#cb79-4"></a> <span class="dt">na.rm =</span> <span class="ot">TRUE</span>,</span>
<span id="cb79-5"><a href="#cb79-5"></a> <span class="dt">name =</span> <span class="st">&quot;protein&quot;</span>)</span></code></pre></div>
<pre><code>## Your quantitative and row data contain missing values. Please read the
## relevant section(s) in the aggregateFeatures manual page regarding the
## effects of missing values on data aggregation.</code></pre>
<div class="sourceCode" id="cb81"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb81-1"><a href="#cb81-1"></a>pe3 &lt;-<span class="st"> </span><span class="kw">aggregateFeatures</span>(pe3,</span>
<span id="cb81-2"><a href="#cb81-2"></a> <span class="dt">i =</span> <span class="st">&quot;peptideNorm&quot;</span>,</span>
<span id="cb81-3"><a href="#cb81-3"></a> <span class="dt">fcol =</span> <span class="st">&quot;Proteins&quot;</span>,</span>
<span id="cb81-4"><a href="#cb81-4"></a> <span class="dt">na.rm =</span> <span class="ot">TRUE</span>,</span>
<span id="cb81-5"><a href="#cb81-5"></a> <span class="dt">name =</span> <span class="st">&quot;protein&quot;</span>)</span></code></pre></div>
<pre><code>## Your quantitative and row data contain missing values. Please read the
## relevant section(s) in the aggregateFeatures manual page regarding the
## effects of missing values on data aggregation.</code></pre>
</p>
</details>
</div>
</div>
<div id="data-exploration-what-is-impact-of-blocking" class="section level3">
<h3><span class="header-section-number">3.2.3</span> Data Exploration: what is impact of blocking?</h3>
<details>
<summary> Click to see code </summary>
<p>
<div class="sourceCode" id="cb83"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb83-1"><a href="#cb83-1"></a><span class="kw">levels</span>(<span class="kw">colData</span>(pe3)<span class="op">$</span>mouse) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;m&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">7</span>)</span>
<span id="cb83-2"><a href="#cb83-2"></a>mdsObj3 &lt;-<span class="st"> </span><span class="kw">plotMDS</span>(<span class="kw">assay</span>(pe3[[<span class="st">&quot;protein&quot;</span>]]), <span class="dt">plot =</span> <span class="ot">FALSE</span>)</span>
<span id="cb83-3"><a href="#cb83-3"></a>mdsOrig &lt;-<span class="st"> </span><span class="kw">colData</span>(pe3) <span class="op">%&gt;%</span></span>
<span id="cb83-4"><a href="#cb83-4"></a><span class="st">  </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb83-5"><a href="#cb83-5"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mds1 =</span> mdsObj3<span class="op">$</span>x,</span>
<span id="cb83-6"><a href="#cb83-6"></a>         <span class="dt">mds2 =</span> mdsObj3<span class="op">$</span>y,</span>
<span id="cb83-7"><a href="#cb83-7"></a>         <span class="dt">lab =</span> <span class="kw">paste</span>(mouse,celltype,<span class="dt">sep=</span><span class="st">&quot;_&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb83-8"><a href="#cb83-8"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mds1, <span class="dt">y =</span> mds2, <span class="dt">label =</span> lab, <span class="dt">color =</span> celltype, <span class="dt">group =</span> mouse)) <span class="op">+</span></span>
<span id="cb83-9"><a href="#cb83-9"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb83-10"><a href="#cb83-10"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb83-11"><a href="#cb83-11"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></span>
<span id="cb83-12"><a href="#cb83-12"></a><span class="st">  </span><span class="kw">xlab</span>(</span>
<span id="cb83-13"><a href="#cb83-13"></a>    <span class="kw">paste0</span>(</span>
<span id="cb83-14"><a href="#cb83-14"></a>      mdsObj3<span class="op">$</span>axislabel,</span>
<span id="cb83-15"><a href="#cb83-15"></a>      <span class="st">&quot; &quot;</span>,</span>
<span id="cb83-16"><a href="#cb83-16"></a>      <span class="dv">1</span>, </span>
<span id="cb83-17"><a href="#cb83-17"></a>      <span class="st">&quot; (&quot;</span>,</span>
<span id="cb83-18"><a href="#cb83-18"></a>      <span class="kw">paste0</span>(</span>
<span id="cb83-19"><a href="#cb83-19"></a>        <span class="kw">round</span>(mdsObj3<span class="op">$</span>var.explained[<span class="dv">1</span>] <span class="op">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb83-20"><a href="#cb83-20"></a>        <span class="st">&quot;%&quot;</span></span>
<span id="cb83-21"><a href="#cb83-21"></a>        ),</span>
<span id="cb83-22"><a href="#cb83-22"></a>      <span class="st">&quot;)&quot;</span></span>
<span id="cb83-23"><a href="#cb83-23"></a>      )</span>
<span id="cb83-24"><a href="#cb83-24"></a>    ) <span class="op">+</span></span>
<span id="cb83-25"><a href="#cb83-25"></a><span class="st">  </span><span class="kw">ylab</span>(</span>
<span id="cb83-26"><a href="#cb83-26"></a>    <span class="kw">paste0</span>(</span>
<span id="cb83-27"><a href="#cb83-27"></a>      mdsObj3<span class="op">$</span>axislabel,</span>
<span id="cb83-28"><a href="#cb83-28"></a>      <span class="st">&quot; &quot;</span>,</span>
<span id="cb83-29"><a href="#cb83-29"></a>      <span class="dv">2</span>, </span>
<span id="cb83-30"><a href="#cb83-30"></a>      <span class="st">&quot; (&quot;</span>,</span>
<span id="cb83-31"><a href="#cb83-31"></a>      <span class="kw">paste0</span>(</span>
<span id="cb83-32"><a href="#cb83-32"></a>        <span class="kw">round</span>(mdsObj3<span class="op">$</span>var.explained[<span class="dv">2</span>] <span class="op">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb83-33"><a href="#cb83-33"></a>        <span class="st">&quot;%&quot;</span></span>
<span id="cb83-34"><a href="#cb83-34"></a>        ),</span>
<span id="cb83-35"><a href="#cb83-35"></a>      <span class="st">&quot;)&quot;</span></span>
<span id="cb83-36"><a href="#cb83-36"></a>      )</span>
<span id="cb83-37"><a href="#cb83-37"></a>    ) <span class="op">+</span></span>
<span id="cb83-38"><a href="#cb83-38"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Original (RCB)&quot;</span>)</span>
<span id="cb83-39"><a href="#cb83-39"></a></span>
<span id="cb83-40"><a href="#cb83-40"></a><span class="kw">levels</span>(<span class="kw">colData</span>(pe)<span class="op">$</span>mouse) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;m&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">4</span>)</span>
<span id="cb83-41"><a href="#cb83-41"></a>mdsObj &lt;-<span class="st"> </span><span class="kw">plotMDS</span>(<span class="kw">assay</span>(pe[[<span class="st">&quot;protein&quot;</span>]]), <span class="dt">plot =</span> <span class="ot">FALSE</span>)</span>
<span id="cb83-42"><a href="#cb83-42"></a>mdsRCB &lt;-<span class="st"> </span><span class="kw">colData</span>(pe) <span class="op">%&gt;%</span></span>
<span id="cb83-43"><a href="#cb83-43"></a><span class="st">  </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb83-44"><a href="#cb83-44"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mds1 =</span> mdsObj<span class="op">$</span>x,</span>
<span id="cb83-45"><a href="#cb83-45"></a>         <span class="dt">mds2 =</span> mdsObj<span class="op">$</span>y,</span>
<span id="cb83-46"><a href="#cb83-46"></a>         <span class="dt">lab =</span> <span class="kw">paste</span>(mouse,celltype,<span class="dt">sep=</span><span class="st">&quot;_&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb83-47"><a href="#cb83-47"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mds1, <span class="dt">y =</span> mds2, <span class="dt">label =</span> lab, <span class="dt">color =</span> celltype, <span class="dt">group =</span> mouse)) <span class="op">+</span></span>
<span id="cb83-48"><a href="#cb83-48"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb83-49"><a href="#cb83-49"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb83-50"><a href="#cb83-50"></a><span class="st">  </span><span class="kw">geom_line</span>(<span class="dt">color =</span> <span class="st">&quot;black&quot;</span>, <span class="dt">linetype =</span> <span class="st">&quot;dashed&quot;</span>) <span class="op">+</span></span>
<span id="cb83-51"><a href="#cb83-51"></a><span class="st">  </span><span class="kw">xlab</span>(</span>
<span id="cb83-52"><a href="#cb83-52"></a>    <span class="kw">paste0</span>(</span>
<span id="cb83-53"><a href="#cb83-53"></a>      mdsObj<span class="op">$</span>axislabel,</span>
<span id="cb83-54"><a href="#cb83-54"></a>      <span class="st">&quot; &quot;</span>,</span>
<span id="cb83-55"><a href="#cb83-55"></a>      <span class="dv">1</span>, </span>
<span id="cb83-56"><a href="#cb83-56"></a>      <span class="st">&quot; (&quot;</span>,</span>
<span id="cb83-57"><a href="#cb83-57"></a>      <span class="kw">paste0</span>(</span>
<span id="cb83-58"><a href="#cb83-58"></a>        <span class="kw">round</span>(mdsObj<span class="op">$</span>var.explained[<span class="dv">1</span>] <span class="op">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb83-59"><a href="#cb83-59"></a>        <span class="st">&quot;%&quot;</span></span>
<span id="cb83-60"><a href="#cb83-60"></a>        ),</span>
<span id="cb83-61"><a href="#cb83-61"></a>      <span class="st">&quot;)&quot;</span></span>
<span id="cb83-62"><a href="#cb83-62"></a>      )</span>
<span id="cb83-63"><a href="#cb83-63"></a>    ) <span class="op">+</span></span>
<span id="cb83-64"><a href="#cb83-64"></a><span class="st">  </span><span class="kw">ylab</span>(</span>
<span id="cb83-65"><a href="#cb83-65"></a>    <span class="kw">paste0</span>(</span>
<span id="cb83-66"><a href="#cb83-66"></a>      mdsObj<span class="op">$</span>axislabel,</span>
<span id="cb83-67"><a href="#cb83-67"></a>      <span class="st">&quot; &quot;</span>,</span>
<span id="cb83-68"><a href="#cb83-68"></a>      <span class="dv">2</span>, </span>
<span id="cb83-69"><a href="#cb83-69"></a>      <span class="st">&quot; (&quot;</span>,</span>
<span id="cb83-70"><a href="#cb83-70"></a>      <span class="kw">paste0</span>(</span>
<span id="cb83-71"><a href="#cb83-71"></a>        <span class="kw">round</span>(mdsObj<span class="op">$</span>var.explained[<span class="dv">2</span>] <span class="op">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb83-72"><a href="#cb83-72"></a>        <span class="st">&quot;%&quot;</span></span>
<span id="cb83-73"><a href="#cb83-73"></a>        ),</span>
<span id="cb83-74"><a href="#cb83-74"></a>      <span class="st">&quot;)&quot;</span></span>
<span id="cb83-75"><a href="#cb83-75"></a>      )</span>
<span id="cb83-76"><a href="#cb83-76"></a>    ) <span class="op">+</span></span>
<span id="cb83-77"><a href="#cb83-77"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Randomized Complete Block (RCB)&quot;</span>)</span>
<span id="cb83-78"><a href="#cb83-78"></a></span>
<span id="cb83-79"><a href="#cb83-79"></a></span>
<span id="cb83-80"><a href="#cb83-80"></a><span class="kw">levels</span>(<span class="kw">colData</span>(pe2)<span class="op">$</span>mouse) &lt;-<span class="st"> </span><span class="kw">paste0</span>(<span class="st">&quot;m&quot;</span>,<span class="dv">1</span><span class="op">:</span><span class="dv">8</span>)</span>
<span id="cb83-81"><a href="#cb83-81"></a>mdsObj2 &lt;-<span class="st"> </span><span class="kw">plotMDS</span>(<span class="kw">assay</span>(pe2[[<span class="st">&quot;protein&quot;</span>]]), <span class="dt">plot =</span> <span class="ot">FALSE</span>)</span>
<span id="cb83-82"><a href="#cb83-82"></a>mdsCRD &lt;-<span class="st"> </span><span class="kw">colData</span>(pe2) <span class="op">%&gt;%</span></span>
<span id="cb83-83"><a href="#cb83-83"></a><span class="st">  </span>as.data.frame <span class="op">%&gt;%</span></span>
<span id="cb83-84"><a href="#cb83-84"></a><span class="st">  </span><span class="kw">mutate</span>(<span class="dt">mds1 =</span> mdsObj2<span class="op">$</span>x,</span>
<span id="cb83-85"><a href="#cb83-85"></a>         <span class="dt">mds2 =</span> mdsObj2<span class="op">$</span>y,</span>
<span id="cb83-86"><a href="#cb83-86"></a>         <span class="dt">lab =</span> <span class="kw">paste</span>(mouse,celltype,<span class="dt">sep=</span><span class="st">&quot;_&quot;</span>)) <span class="op">%&gt;%</span></span>
<span id="cb83-87"><a href="#cb83-87"></a><span class="st">  </span><span class="kw">ggplot</span>(<span class="kw">aes</span>(<span class="dt">x =</span> mds1, <span class="dt">y =</span> mds2, <span class="dt">label =</span> lab, <span class="dt">color =</span> celltype, <span class="dt">group =</span> mouse)) <span class="op">+</span></span>
<span id="cb83-88"><a href="#cb83-88"></a><span class="st">  </span><span class="kw">geom_text</span>(<span class="dt">show.legend =</span> <span class="ot">FALSE</span>) <span class="op">+</span></span>
<span id="cb83-89"><a href="#cb83-89"></a><span class="st">  </span><span class="kw">geom_point</span>(<span class="dt">shape =</span> <span class="dv">21</span>) <span class="op">+</span></span>
<span id="cb83-90"><a href="#cb83-90"></a><span class="st">  </span><span class="kw">xlab</span>(</span>
<span id="cb83-91"><a href="#cb83-91"></a>    <span class="kw">paste0</span>(</span>
<span id="cb83-92"><a href="#cb83-92"></a>      mdsObj<span class="op">$</span>axislabel,</span>
<span id="cb83-93"><a href="#cb83-93"></a>      <span class="st">&quot; &quot;</span>,</span>
<span id="cb83-94"><a href="#cb83-94"></a>      <span class="dv">1</span>, </span>
<span id="cb83-95"><a href="#cb83-95"></a>      <span class="st">&quot; (&quot;</span>,</span>
<span id="cb83-96"><a href="#cb83-96"></a>      <span class="kw">paste0</span>(</span>
<span id="cb83-97"><a href="#cb83-97"></a>        <span class="kw">round</span>(mdsObj2<span class="op">$</span>var.explained[<span class="dv">1</span>] <span class="op">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb83-98"><a href="#cb83-98"></a>        <span class="st">&quot;%&quot;</span></span>
<span id="cb83-99"><a href="#cb83-99"></a>        ),</span>
<span id="cb83-100"><a href="#cb83-100"></a>      <span class="st">&quot;)&quot;</span></span>
<span id="cb83-101"><a href="#cb83-101"></a>      )</span>
<span id="cb83-102"><a href="#cb83-102"></a>    ) <span class="op">+</span></span>
<span id="cb83-103"><a href="#cb83-103"></a><span class="st">  </span><span class="kw">ylab</span>(</span>
<span id="cb83-104"><a href="#cb83-104"></a>    <span class="kw">paste0</span>(</span>
<span id="cb83-105"><a href="#cb83-105"></a>      mdsObj<span class="op">$</span>axislabel,</span>
<span id="cb83-106"><a href="#cb83-106"></a>      <span class="st">&quot; &quot;</span>,</span>
<span id="cb83-107"><a href="#cb83-107"></a>      <span class="dv">2</span>, </span>
<span id="cb83-108"><a href="#cb83-108"></a>      <span class="st">&quot; (&quot;</span>,</span>
<span id="cb83-109"><a href="#cb83-109"></a>      <span class="kw">paste0</span>(</span>
<span id="cb83-110"><a href="#cb83-110"></a>        <span class="kw">round</span>(mdsObj2<span class="op">$</span>var.explained[<span class="dv">2</span>] <span class="op">*</span><span class="dv">100</span>,<span class="dv">0</span>),</span>
<span id="cb83-111"><a href="#cb83-111"></a>        <span class="st">&quot;%&quot;</span></span>
<span id="cb83-112"><a href="#cb83-112"></a>        ),</span>
<span id="cb83-113"><a href="#cb83-113"></a>      <span class="st">&quot;)&quot;</span></span>
<span id="cb83-114"><a href="#cb83-114"></a>      )</span>
<span id="cb83-115"><a href="#cb83-115"></a>    ) <span class="op">+</span></span>
<span id="cb83-116"><a href="#cb83-116"></a><span class="st">  </span><span class="kw">ggtitle</span>(<span class="st">&quot;Completely Randomized Design (CRD)&quot;</span>)</span></code></pre></div>
</p>
</details>
<div class="sourceCode" id="cb84"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb84-1"><a href="#cb84-1"></a>mdsOrig</span></code></pre></div>
<p><img src="experimentalDesign_files/figure-html/unnamed-chunk-65-1.png" width="672" /></p>
<div class="sourceCode" id="cb85"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb85-1"><a href="#cb85-1"></a>mdsRCB</span></code></pre></div>
<p><img src="experimentalDesign_files/figure-html/unnamed-chunk-65-2.png" width="672" /></p>
<div class="sourceCode" id="cb86"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb86-1"><a href="#cb86-1"></a>mdsCRD</span></code></pre></div>
<p><img src="experimentalDesign_files/figure-html/unnamed-chunk-65-3.png" width="672" /></p>
<ul>
<li><p>We observe that the leading fold change is according to mouse</p></li>
<li><p>In the second dimension we see a separation according to cell-type</p></li>
<li><p>With the Randomized Complete Block design (RCB) we can remove the mouse effect from the analysis!</p></li>
<li><p>We can isolate the between block variability from the analysis using linear model: <span class="math display">\[ 
y \sim \text{celltype} + \text{mouse}
\]</span></p></li>
<li><p>Possible in msqrob2 and MSstats but not possible with Perseus!</p></li>
</ul>
</div>
</div>
<div id="modeling-and-inference" class="section level2">
<h2><span class="header-section-number">3.3</span> Modeling and inference</h2>
<div id="rcb-analysis" class="section level3">
<h3><span class="header-section-number">3.3.1</span> RCB analysis</h3>
<div class="sourceCode" id="cb87"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb87-1"><a href="#cb87-1"></a>pe &lt;-<span class="st"> </span><span class="kw">msqrob</span>(</span>
<span id="cb87-2"><a href="#cb87-2"></a>  <span class="dt">object =</span> pe,</span>
<span id="cb87-3"><a href="#cb87-3"></a>  <span class="dt">i =</span> <span class="st">&quot;protein&quot;</span>,</span>
<span id="cb87-4"><a href="#cb87-4"></a>  <span class="dt">formula =</span> <span class="op">~</span><span class="st"> </span>celltype <span class="op">+</span><span class="st"> </span>mouse)</span></code></pre></div>
</div>
<div id="rcb-wrong-analysis" class="section level3">
<h3><span class="header-section-number">3.3.2</span> RCB wrong analysis</h3>
<div class="sourceCode" id="cb88"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb88-1"><a href="#cb88-1"></a>pe &lt;-<span class="st"> </span><span class="kw">msqrob</span>(</span>
<span id="cb88-2"><a href="#cb88-2"></a>  <span class="dt">object =</span> pe,</span>
<span id="cb88-3"><a href="#cb88-3"></a>  <span class="dt">i =</span> <span class="st">&quot;protein&quot;</span>,</span>
<span id="cb88-4"><a href="#cb88-4"></a>  <span class="dt">formula =</span> <span class="op">~</span><span class="st"> </span>celltype, <span class="dt">modelColumnName =</span> <span class="st">&quot;wrongModel&quot;</span>)</span></code></pre></div>
</div>
<div id="crd-analysis" class="section level3">
<h3><span class="header-section-number">3.3.3</span> CRD analysis</h3>
<div class="sourceCode" id="cb89"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb89-1"><a href="#cb89-1"></a>pe2 &lt;-<span class="st"> </span><span class="kw">msqrob</span>(</span>
<span id="cb89-2"><a href="#cb89-2"></a>  <span class="dt">object =</span> pe2,</span>
<span id="cb89-3"><a href="#cb89-3"></a>  <span class="dt">i =</span> <span class="st">&quot;protein&quot;</span>,</span>
<span id="cb89-4"><a href="#cb89-4"></a>  <span class="dt">formula =</span> <span class="op">~</span><span class="st"> </span>celltype)</span></code></pre></div>
</div>
<div id="estimation-effect-size-and-inference" class="section level3">
<h3><span class="header-section-number">3.3.4</span> Estimation, effect size and inference</h3>
<p>Effect size in RCB</p>
<div class="sourceCode" id="cb90"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb90-1"><a href="#cb90-1"></a><span class="kw">library</span>(ExploreModelMatrix)</span>
<span id="cb90-2"><a href="#cb90-2"></a><span class="kw">VisualizeDesign</span>(<span class="kw">colData</span>(pe),<span class="op">~</span><span class="st"> </span>celltype <span class="op">+</span><span class="st"> </span>mouse)<span class="op">$</span>plotlist</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="experimentalDesign_files/figure-html/unnamed-chunk-69-1.png" width="672" /></p>
<p>Effect size in CRD</p>
<div class="sourceCode" id="cb92"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb92-1"><a href="#cb92-1"></a><span class="kw">VisualizeDesign</span>(<span class="kw">colData</span>(pe2),<span class="op">~</span><span class="st"> </span>celltype)<span class="op">$</span>plotlist</span></code></pre></div>
<pre><code>## [[1]]</code></pre>
<p><img src="experimentalDesign_files/figure-html/unnamed-chunk-70-1.png" width="672" /></p>
<div class="sourceCode" id="cb94"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb94-1"><a href="#cb94-1"></a>L &lt;-<span class="st"> </span><span class="kw">makeContrast</span>(<span class="st">&quot;celltypeTreg = 0&quot;</span>, <span class="dt">parameterNames =</span> <span class="kw">c</span>(<span class="st">&quot;celltypeTreg&quot;</span>))</span>
<span id="cb94-2"><a href="#cb94-2"></a>pe &lt;-<span class="st"> </span><span class="kw">hypothesisTest</span>(<span class="dt">object =</span> pe, <span class="dt">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="dt">contrast =</span> L)</span>
<span id="cb94-3"><a href="#cb94-3"></a>pe &lt;-<span class="st"> </span><span class="kw">hypothesisTest</span>(<span class="dt">object =</span> pe, <span class="dt">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="dt">contrast =</span> L, <span class="dt">modelColumn =</span> <span class="st">&quot;wrongModel&quot;</span>, <span class="dt">resultsColumnNamePrefix=</span><span class="st">&quot;wrong&quot;</span>)</span>
<span id="cb94-4"><a href="#cb94-4"></a>pe2 &lt;-<span class="st"> </span><span class="kw">hypothesisTest</span>(<span class="dt">object =</span> pe2, <span class="dt">i =</span> <span class="st">&quot;protein&quot;</span>, <span class="dt">contrast =</span> L)</span></code></pre></div>
</div>
<div id="comparison-of-results" class="section level3">
<h3><span class="header-section-number">3.3.5</span> Comparison of results</h3>
<details>
<summary> Click to see code </summary>
<p>
<div class="sourceCode" id="cb95"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb95-1"><a href="#cb95-1"></a>volcanoRCB &lt;-<span class="st"> </span><span class="kw">ggplot</span>(</span>
<span id="cb95-2"><a href="#cb95-2"></a>    <span class="kw">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>celltypeTreg,</span>
<span id="cb95-3"><a href="#cb95-3"></a>    <span class="kw">aes</span>(<span class="dt">x =</span> logFC, <span class="dt">y =</span> <span class="op">-</span><span class="kw">log10</span>(pval), <span class="dt">color =</span> adjPval <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)</span>
<span id="cb95-4"><a href="#cb95-4"></a>) <span class="op">+</span></span>
<span id="cb95-5"><a href="#cb95-5"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb95-6"><a href="#cb95-6"></a><span class="st">    </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">alpha</span>(<span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="op">+</span></span>
<span id="cb95-7"><a href="#cb95-7"></a><span class="st">    </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb95-8"><a href="#cb95-8"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">paste0</span>(<span class="st">&quot;RCB: </span><span class="ch">\n</span><span class="st">&quot;</span>, </span>
<span id="cb95-9"><a href="#cb95-9"></a>                <span class="kw">sum</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>celltypeTreg<span class="op">$</span>adjPval<span class="op">&lt;</span><span class="fl">0.05</span>,<span class="dt">na.rm=</span><span class="ot">TRUE</span>),</span>
<span id="cb95-10"><a href="#cb95-10"></a>            <span class="st">&quot; significant&quot;</span>))</span>
<span id="cb95-11"><a href="#cb95-11"></a></span>
<span id="cb95-12"><a href="#cb95-12"></a>volcanoRCBwrong &lt;-<span class="st"> </span><span class="kw">ggplot</span>(</span>
<span id="cb95-13"><a href="#cb95-13"></a>    <span class="kw">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>wrongcelltypeTreg,</span>
<span id="cb95-14"><a href="#cb95-14"></a>    <span class="kw">aes</span>(<span class="dt">x =</span> logFC, <span class="dt">y =</span> <span class="op">-</span><span class="kw">log10</span>(pval), <span class="dt">color =</span> adjPval <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)</span>
<span id="cb95-15"><a href="#cb95-15"></a>) <span class="op">+</span></span>
<span id="cb95-16"><a href="#cb95-16"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb95-17"><a href="#cb95-17"></a><span class="st">    </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">alpha</span>(<span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="op">+</span></span>
<span id="cb95-18"><a href="#cb95-18"></a><span class="st">    </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb95-19"><a href="#cb95-19"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">paste0</span>(<span class="st">&quot;RCB wrong: </span><span class="ch">\n</span><span class="st">&quot;</span>, </span>
<span id="cb95-20"><a href="#cb95-20"></a>                <span class="kw">sum</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>wrongcelltypeTreg<span class="op">$</span>adjPval<span class="op">&lt;</span><span class="fl">0.05</span>,<span class="dt">na.rm=</span><span class="ot">TRUE</span>),</span>
<span id="cb95-21"><a href="#cb95-21"></a>            <span class="st">&quot; significant&quot;</span>))</span>
<span id="cb95-22"><a href="#cb95-22"></a></span>
<span id="cb95-23"><a href="#cb95-23"></a>volcanoCRD &lt;-<span class="st"> </span><span class="kw">ggplot</span>(</span>
<span id="cb95-24"><a href="#cb95-24"></a>    <span class="kw">rowData</span>(pe2[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>celltypeTreg,</span>
<span id="cb95-25"><a href="#cb95-25"></a>    <span class="kw">aes</span>(<span class="dt">x =</span> logFC, <span class="dt">y =</span> <span class="op">-</span><span class="kw">log10</span>(pval), <span class="dt">color =</span> adjPval <span class="op">&lt;</span><span class="st"> </span><span class="fl">0.05</span>)</span>
<span id="cb95-26"><a href="#cb95-26"></a>) <span class="op">+</span></span>
<span id="cb95-27"><a href="#cb95-27"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">cex =</span> <span class="fl">2.5</span>) <span class="op">+</span></span>
<span id="cb95-28"><a href="#cb95-28"></a><span class="st">    </span><span class="kw">scale_color_manual</span>(<span class="dt">values =</span> <span class="kw">alpha</span>(<span class="kw">c</span>(<span class="st">&quot;black&quot;</span>, <span class="st">&quot;red&quot;</span>), <span class="fl">0.5</span>)) <span class="op">+</span></span>
<span id="cb95-29"><a href="#cb95-29"></a><span class="st">    </span><span class="kw">theme_minimal</span>() <span class="op">+</span></span>
<span id="cb95-30"><a href="#cb95-30"></a><span class="st">    </span><span class="kw">ggtitle</span>(<span class="kw">paste0</span>(<span class="st">&quot;CRD: </span><span class="ch">\n</span><span class="st">&quot;</span>, </span>
<span id="cb95-31"><a href="#cb95-31"></a>                <span class="kw">sum</span>(<span class="kw">rowData</span>(pe2[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>celltypeTreg<span class="op">$</span>adjPval<span class="op">&lt;</span><span class="fl">0.05</span>,<span class="dt">na.rm=</span><span class="ot">TRUE</span>),</span>
<span id="cb95-32"><a href="#cb95-32"></a>            <span class="st">&quot; significant&quot;</span>))</span></code></pre></div>
</p>
</details>
<div class="sourceCode" id="cb96"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb96-1"><a href="#cb96-1"></a><span class="kw">grid.arrange</span>(volcanoRCB,volcanoCRD, volcanoRCBwrong,<span class="dt">ncol=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 777 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 382 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 262 rows containing missing values (geom_point).</code></pre>
<p><img src="experimentalDesign_files/figure-html/unnamed-chunk-73-1.png" width="672" /></p>
</div>
<div id="comparison-of-standard-deviation" class="section level3">
<h3><span class="header-section-number">3.3.6</span> Comparison of standard deviation</h3>
<details>
<summary> Click to see code </summary>
<p>
<div class="sourceCode" id="cb100"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb100-1"><a href="#cb100-1"></a>accessions &lt;-<span class="st"> </span><span class="kw">rownames</span>(pe[[<span class="st">&quot;protein&quot;</span>]])[<span class="kw">rownames</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="op">%in%</span><span class="kw">rownames</span>(pe2[[<span class="st">&quot;protein&quot;</span>]])]</span>
<span id="cb100-2"><a href="#cb100-2"></a>dat &lt;-<span class="st"> </span><span class="kw">data.frame</span>(</span>
<span id="cb100-3"><a href="#cb100-3"></a><span class="dt">sigmaRBC =</span> <span class="kw">sapply</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>msqrobModels[accessions], getSigmaPosterior),</span>
<span id="cb100-4"><a href="#cb100-4"></a><span class="dt">sigmaRBCwrong =</span> <span class="kw">sapply</span>(<span class="kw">rowData</span>(pe[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>wrongModel[accessions], getSigmaPosterior),</span>
<span id="cb100-5"><a href="#cb100-5"></a>sigmaCRD &lt;-<span class="st"> </span><span class="kw">sapply</span>(<span class="kw">rowData</span>(pe2[[<span class="st">&quot;protein&quot;</span>]])<span class="op">$</span>msqrobModels[accessions], getSigmaPosterior)</span>
<span id="cb100-6"><a href="#cb100-6"></a>)</span>
<span id="cb100-7"><a href="#cb100-7"></a></span>
<span id="cb100-8"><a href="#cb100-8"></a> plotRBCvsWrong &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(sigmaRBC, sigmaRBCwrong)) <span class="op">+</span></span>
<span id="cb100-9"><a href="#cb100-9"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>, <span class="dt">shape =</span> <span class="dv">20</span>) <span class="op">+</span></span>
<span id="cb100-10"><a href="#cb100-10"></a><span class="st">    </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb100-11"><a href="#cb100-11"></a><span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></span>
<span id="cb100-12"><a href="#cb100-12"></a><span class="st">    </span><span class="kw">geom_abline</span>(<span class="dt">intercept=</span><span class="dv">0</span>,<span class="dt">slope=</span><span class="dv">1</span>)</span>
<span id="cb100-13"><a href="#cb100-13"></a>plotCRDvsWrong &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(sigmaCRD, sigmaRBCwrong)) <span class="op">+</span></span>
<span id="cb100-14"><a href="#cb100-14"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>, <span class="dt">shape =</span> <span class="dv">20</span>) <span class="op">+</span></span>
<span id="cb100-15"><a href="#cb100-15"></a><span class="st">    </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb100-16"><a href="#cb100-16"></a><span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></span>
<span id="cb100-17"><a href="#cb100-17"></a><span class="st">    </span><span class="kw">geom_abline</span>(<span class="dt">intercept=</span><span class="dv">0</span>,<span class="dt">slope=</span><span class="dv">1</span>)</span>
<span id="cb100-18"><a href="#cb100-18"></a>plotRBCvsCRD &lt;-<span class="st"> </span><span class="kw">ggplot</span>(<span class="dt">data =</span> dat, <span class="kw">aes</span>(sigmaRBC, sigmaCRD)) <span class="op">+</span></span>
<span id="cb100-19"><a href="#cb100-19"></a><span class="st">    </span><span class="kw">geom_point</span>(<span class="dt">alpha =</span> <span class="fl">0.1</span>, <span class="dt">shape =</span> <span class="dv">20</span>) <span class="op">+</span></span>
<span id="cb100-20"><a href="#cb100-20"></a><span class="st">    </span><span class="kw">scale_x_log10</span>() <span class="op">+</span></span>
<span id="cb100-21"><a href="#cb100-21"></a><span class="st">    </span><span class="kw">scale_y_log10</span>() <span class="op">+</span></span>
<span id="cb100-22"><a href="#cb100-22"></a><span class="st">    </span><span class="kw">geom_abline</span>(<span class="dt">intercept=</span><span class="dv">0</span>,<span class="dt">slope=</span><span class="dv">1</span>)</span></code></pre></div>
</p>
</details>
<div class="sourceCode" id="cb101"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb101-1"><a href="#cb101-1"></a><span class="kw">grid.arrange</span>(</span>
<span id="cb101-2"><a href="#cb101-2"></a>  plotRBCvsWrong,</span>
<span id="cb101-3"><a href="#cb101-3"></a>  plotCRDvsWrong,</span>
<span id="cb101-4"><a href="#cb101-4"></a>  plotRBCvsCRD,</span>
<span id="cb101-5"><a href="#cb101-5"></a>  <span class="dt">nrow=</span><span class="dv">2</span>)</span></code></pre></div>
<pre><code>## Warning: Removed 730 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 397 rows containing missing values (geom_point).</code></pre>
<pre><code>## Warning: Removed 743 rows containing missing values (geom_point).</code></pre>
<p><img src="experimentalDesign_files/figure-html/unnamed-chunk-75-1.png" width="672" /></p>
<ul>
<li><p>We clearly observe that the standard deviation of the protein expression in the RCB is smaller for the majority of the proteins than that obtained with the CRD</p></li>
<li><p>The standard deviation of the protein expression RCB where we perform a wrong analysis without considering the blocking factor according to mouse is much larger for the marjority of the proteins than that obtained with the correct analysis.</p></li>
<li><p>Indeed, when we ignore the blocking factor in the RCB design we do not remove the variability according to mouse from the analysis and the mouse effect is absorbed in the error term. The standard deviation than becomes very comparable to that observed in the completely randomised design where we could not remove the mouse effect from the analysis.</p></li>
<li><p>Why are some of the standard deviations for the RCB with the correct analysis larger than than of the RCB with the incorrect analysis that ignored the mouse blocking factor?</p></li>
<li><p>Can you think of a reason why it would not be useful to block on a particular factor?</p></li>
</ul>
</div>
</div>
</div>

<div id="rmd-source-code">LS0tCnRpdGxlOiAiIEV4cGVyaW1lbnRhbCBkZXNpZ24gY29uY2VwdHMgZm9yIGxhYmVsLWZyZWUgcHJvdGVvbWljcyBleHBlcmltZW50cyIKYXV0aG9yOiAiTGlldmVuIENsZW1lbnQiCmRhdGU6ICJbc3RhdE9taWNzXShodHRwczovL3N0YXRvbWljcy5naXRodWIuaW8pLCBHaGVudCBVbml2ZXJzaXR5IgpvdXRwdXQ6CiAgICBodG1sX2RvY3VtZW50OgogICAgICBjb2RlX2Rvd25sb2FkOiB0cnVlCiAgICAgIHRoZW1lOiBjb3NtbwogICAgICB0b2M6IHRydWUKICAgICAgdG9jX2Zsb2F0OiB0cnVlCiAgICAgIGhpZ2hsaWdodDogdGFuZ28KICAgICAgbnVtYmVyX3NlY3Rpb25zOiB0cnVlCiAgICBwZGZfZG9jdW1lbnQ6CiAgICAgIHRvYzogdHJ1ZQogICAgICBudW1iZXJfc2VjdGlvbnM6IHRydWUKbGlua2NvbG9yOiBibHVlCnVybGNvbG9yOiBibHVlCmNpdGVjb2xvcjogYmx1ZQoKYmlibGlvZ3JhcGh5OiBtc3Fyb2IyLmJpYgogICAgICAKLS0tCgo8YSByZWw9ImxpY2Vuc2UiIGhyZWY9Imh0dHBzOi8vY3JlYXRpdmVjb21tb25zLm9yZy9saWNlbnNlcy9ieS1uYy1zYS80LjAiPjxpbWcgYWx0PSJDcmVhdGl2ZSBDb21tb25zIExpY2Vuc2UiIHN0eWxlPSJib3JkZXItd2lkdGg6MCIgc3JjPSJodHRwczovL2kuY3JlYXRpdmVjb21tb25zLm9yZy9sL2J5LW5jLXNhLzQuMC84OHgzMS5wbmciIC8+PC9hPgoKVGhpcyBpcyBwYXJ0IG9mIHRoZSBvbmxpbmUgY291cnNlIFtFeHBlcmltZW50YWwgRGVzaWduIGFuZCBEYXRhLUFuYWx5c2lzIGluIExhYmVsLUZyZWUgUXVhbnRpdGF0aXZlIExDL01TIFByb3Rlb21pY3MgLSBBIFR1dG9yaWFsIHdpdGggbXNxcm9iMiAoaHVwbzIxKV0oaHR0cHM6Ly9zdGF0b21pY3MuZ2l0aHViLmlvL2h1cG8yMS8pCgoKPGRldGFpbHM+PHN1bW1hcnk+IENsaWNrIHRvIHNlZSBsaWJyYXJpZXMgdGhhdCBhcmUgbG9hZGVkIDwvc3VtbWFyeT48cD4KYGBge3IsIHdhcm5pbmc9RkFMU0UsIG1lc3NhZ2U9RkFMU0V9CmxpYnJhcnkodGlkeXZlcnNlKQpsaWJyYXJ5KGxpbW1hKQpsaWJyYXJ5KFFGZWF0dXJlcykKbGlicmFyeShtc3Fyb2IyKQpsaWJyYXJ5KHBsb3RseSkKbGlicmFyeShncmlkRXh0cmEpCmBgYAo8L3A+PC9kZXRhaWxzPgoKCiMgT3ZlcnZpZXcKCi0gU2FtcGxlIHNpemUgCi0gUmFuZG9taXplZCBDb21wbGV0ZSBCbG9jayBEZXNpZ25zIAoKIyBTYW1wbGUgc2l6ZSAKCiMjIFN0YXRpc3RpY2FsIG1vZGVscyAKLSBVcG9uIHByZXByb2Nlc3NpbmcgYW5kIHN1bW1hcml6YXRpb24gd2UgbW9kZWwgdGhlIGxvZzIgdHJhbnNmb3JtZWQgcHJvdGVpbiBleHByZXNzaW9uICgkeV97aX0kKSB2YWx1ZXMgdXNpbmcgYSBsaW5lYXIgbW9kZWwgCgpcW3lfe2l9PSBcYmV0YV8wICsgXGJldGFfMSB4X3tpLDF9ICsgXGJldGEgeF97aSwyfSArIC4uLiArIFxlcHNpbG9uX2lcXQoKd2l0aCAKCi0gJFxiZXRhXzAkIHRoZSBpbnRlcmNlcHQKLSAkXGJldGFfaiQgdGhlIHNsb3BlIGZvciBwcmVkaWN0b3IgJHhfe2ksan0kCi0gJHhfe2ksan0kIGEgY29udGludW91cyBwcmVkaWN0b3IgKHN1Y2ggYXMgYWdlKSBvciBhIGR1bW15IHZhcmlhYmxlIHRoYXQgY2FuIHRha2UgdmFsdWVzIG9mIDAgYW5kIDEgYW5kIHRoYXQgd2lsbCB1c2VkIGZvciBmYWN0b3JzIChlLmcgdHJlYXRtZW50OiBjYW5jZXIsIG5vcm1hbCkuIAoKRXhhbXBsZTogCgotIEVzdHJvZ2VuIFJlY2VwdG9yIFBvc2l0aXZlIEJyZWFzdCBjYW5jZXIgdGlzc3VlcyBmcm9tIGZyb20gcGF0aWVudHMgdHJlYXRlZCB3aXRoIHRhbW94aWZlbiB1cG9uIHJlY3VycmVuY2UgaGF2ZSBiZWVuIGFzc2Vzc2VkIGluIGEgcHJvdGVvbWljcyBzdHVkeS4gCi0gSGFsZiBvZiB0aGUgcGF0aWVudHMgaGFkIGEgZ29vZCBvdXRjb21lIChvcikgYW5kIHRoZSBvdGhlciBoYWxmIGhhZCBhIHBvb3Igb3V0Y29tZSAocGQpLiAKLSBUaGUgcHJvdGVvbWVzIGhhdmUgYmVlbiBhc3Nlc3NlZCB1c2luZyBhbiBMVFEtT3JiaXRyYXAgYW5kIHRoZSB0aGVybW8gb3V0cHV0IC5SQVcgZmlsZXMgd2VyZSBzZWFyY2hlZCB3aXRoIE1heFF1YW50ICh2ZXJzaW9uIDEuNC4xLjIpIGFnYWluc3QgdGhlIGh1bWFuIHByb3Rlb21lIGRhdGFiYXNlIChGQVNUQSB2ZXJzaW9uIDIwMTItMDksIGh1bWFuIGNhbm9uaWNhbCBwcm90ZW9tZSkuCgpXZSBtb2RlbCB0aGUgZGF0YSBmb3IgYSBzaW5nbGUgcHJvdGVpbiB1c2luZyBhIG1vZGVsOgoKXFt5X3tpfT0gXGJldGFfMCArIFxiZXRhX3tQRH0geF97aSxQRH0gKyBcZXBzaWxvbl9pXF0KCndpdGggCiR4X3tpLFBEfT1cYmVnaW57Y2FzZXN9CjAmIFx0ZXh0e2dvb2Qgb3V0Y29tZX1cXAoxJiBcdGV4dHtwb29yIG91dGNvbWV9ClxlbmR7Y2FzZXN9JC4gCgoKIyMjIFJlYWQgZGF0YSAKCjxkZXRhaWxzPjxzdW1tYXJ5PiBDbGljayB0byBzZWUgYmFja2dyb3VuZCBhbmQgY29kZSA8L3N1bW1hcnk+PHA+CjEuIFdlIHVzZSBhIHBlcHRpZGVzLnR4dCBmaWxlIGZyb20gTVMtZGF0YSBxdWFudGlmaWVkIHdpdGggbWF4cXVhbnQgdGhhdCAKY29udGFpbnMgTVMxIGludGVuc2l0aWVzIHN1bW1hcml6ZWQgYXQgdGhlIHBlcHRpZGUgbGV2ZWwuIApgYGB7cn0KcGVwdGlkZXNGaWxlIDwtICJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vc3RhdE9taWNzL3BkYTIxL2RhdGEvcXVhbnRpZmljYXRpb24vY2FuY2VyL3BlcHRpZGVzM3ZzMy50eHQiCmBgYAoKMi4gTWF4cXVhbnQgc3RvcmVzIHRoZSBpbnRlbnNpdHkgZGF0YSBmb3IgdGhlIGRpZmZlcmVudCBzYW1wbGVzIGluIGNvbHVtbm5zIHRoYXQgc3RhcnQgd2l0aCBJbnRlbnNpdHkuIFdlIGNhbiByZXRyZWl2ZSB0aGUgY29sdW1uIG5hbWVzIHdpdGggdGhlIGludGVuc2l0eSBkYXRhIHdpdGggdGhlIGNvZGUgYmVsb3c6IAoKYGBge3J9CmVjb2xzIDwtIGdyZXAoIkludGVuc2l0eVxcLiIsIG5hbWVzKHJlYWQuZGVsaW0ocGVwdGlkZXNGaWxlKSkpCmBgYAoKMy4gUmVhZCB0aGUgZGF0YSBhbmQgc3RvcmUgaXQgaW4gIFFGZWF0dXJlcyBvYmplY3QgCgpgYGB7cn0KcGUgPC0gcmVhZFFGZWF0dXJlcygKICB0YWJsZSA9IHBlcHRpZGVzRmlsZSwKICBmbmFtZXMgPSAxLAogIGVjb2wgPSBlY29scywKICBuYW1lID0gInBlcHRpZGVSYXciLCBzZXA9Ilx0IikKYGBgCjwvcD48L2RldGFpbHM+CgojIyMgRGVzaWduCgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGJhY2tncm91bmQgYW5kIGNvZGUgPC9zdW1tYXJ5PjxwPgoKYGBge3J9IApwZSAlPiUgY29sbmFtZXMKYGBgCgotIE5vdGUsIHRoYXQgdGhlIHNhbXBsZSBuYW1lcyB0aGUgb3V0Y29tZS4gCi0gV2UgdXBkYXRlIHRoZSBjb2xEYXRhIHdpdGggaW5mb3JtYXRpb24gb24gdGhlIGRlc2lnbgoKYGBge3J9CmNvbERhdGEocGUpJHByb2dub3NpcyA8LSAgcGVbWyJwZXB0aWRlUmF3Il1dICU+JSAKICBjb2xuYW1lcyAlPiUgCiAgc3Vic3RyKDExLDEyKSAlPiUgCiAgYXMuZmFjdG9yCmBgYAoKLSBXZSBleHBsb3JlIHRoZSBjb2xEYXRhCgpgYGB7cn0KY29sRGF0YShwZSkKYGBgCgo8L3A+PC9kZXRhaWxzPgoKIyMjIFByZXByb2Nlc3NpbmcKCgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgZm9yIHByZXByb2Nlc3NpbmcgPC9zdW1tYXJ5PjxwPgoKMS4gTG9nLXRyYW5zZm9ybQoKLSBXZSBjYWxjdWxhdGUgaG93IG1hbnkgbm9uIHplcm8gaW50ZW5zaXRpZXMgd2UgaGF2ZSBmb3IgZWFjaCBwZXB0aWRlIGFuZCB0aGlzIGNhbiBiZSB1c2VmdWwgZm9yIGZpbHRlcmluZy4KCmBgYHtyfQpyb3dEYXRhKHBlW1sicGVwdGlkZVJhdyJdXSkkbk5vblplcm8gPC0gcm93U3Vtcyhhc3NheShwZVtbInBlcHRpZGVSYXciXV0pID4gMCkKYGBgCgoKLSBQZXB0aWRlcyB3aXRoIHplcm8gaW50ZW5zaXRpZXMgYXJlIG1pc3NpbmcgcGVwdGlkZXMgYW5kIHNob3VsZCBiZSByZXByZXNlbnQKd2l0aCBhIGBOQWAgdmFsdWUgcmF0aGVyIHRoYW4gYDBgLgoKYGBge3J9CnBlIDwtIHplcm9Jc05BKHBlLCAicGVwdGlkZVJhdyIpICMgY29udmVydCAwIHRvIE5BCmBgYAoKLSBMb2d0cmFuc2Zvcm0gZGF0YSB3aXRoIGJhc2UgMgoKYGBge3J9CnBlIDwtIGxvZ1RyYW5zZm9ybShwZSwgYmFzZSA9IDIsIGkgPSAicGVwdGlkZVJhdyIsIG5hbWUgPSAicGVwdGlkZUxvZyIpCmBgYAoKMi4gRmlsdGVyaW5nCgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgdG8gZmlsdGVyIHRoZSBkYXRhIDwvc3VtbWFyeT48cD4KCi0gSGFuZGxpbmcgb3ZlcmxhcHBpbmcgcHJvdGVpbiBncm91cHMKCkluIG91ciBhcHByb2FjaCBhIHBlcHRpZGUgY2FuIG1hcCB0byBtdWx0aXBsZSBwcm90ZWlucywgYXMgbG9uZyBhcyB0aGVyZSBpcwpub25lIG9mIHRoZXNlIHByb3RlaW5zIHByZXNlbnQgaW4gYSBzbWFsbGVyIHN1Ymdyb3VwLgoKYGBge3J9CnBlIDwtIGZpbHRlckZlYXR1cmVzKHBlLCB+IFByb3RlaW5zICVpbiUgc21hbGxlc3RVbmlxdWVHcm91cHMocm93RGF0YShwZVtbInBlcHRpZGVMb2ciXV0pJFByb3RlaW5zKSkKYGBgCgotIFJlbW92ZSByZXZlcnNlIHNlcXVlbmNlcyAoZGVjb3lzKSBhbmQgY29udGFtaW5hbnRzCgpXZSBub3cgcmVtb3ZlIHRoZSBjb250YW1pbmFudHMsIHBlcHRpZGVzIHRoYXQgbWFwIHRvIGRlY295IHNlcXVlbmNlcywgYW5kIHByb3RlaW5zCndoaWNoIHdlcmUgb25seSBpZGVudGlmaWVkIGJ5IHBlcHRpZGVzIHdpdGggbW9kaWZpY2F0aW9ucy4KCmBgYHtyfQpwZSA8LSBmaWx0ZXJGZWF0dXJlcyhwZSx+UmV2ZXJzZSAhPSAiKyIpCnBlIDwtIGZpbHRlckZlYXR1cmVzKHBlLH4gQ29udGFtaW5hbnQgIT0gIisiKQpgYGAKCi0gRHJvcCBwZXB0aWRlcyB0aGF0IHdlcmUgb25seSBpZGVudGlmaWVkIGluIG9uZSBzYW1wbGUKCldlIGtlZXAgcGVwdGlkZXMgdGhhdCB3ZXJlIG9ic2VydmVkIGF0IGxhc3QgdHdpY2UuCgpgYGB7cn0KcGUgPC0gZmlsdGVyRmVhdHVyZXMocGUsfiBuTm9uWmVybyA+PTIpCm5yb3cocGVbWyJwZXB0aWRlTG9nIl1dKQpgYGAKCldlIGtlZXAgYHIgbnJvdyhwZVtbInBlcHRpZGVMb2ciXV0pYCBwZXB0aWRlcyB1cG9uIGZpbHRlcmluZy4KCjMuIE5vcm1hbGl6YXRpb24gCgpgYGB7cn0KcGUgPC0gbm9ybWFsaXplKHBlLCAKICAgICAgICAgICAgICAgIGkgPSAicGVwdGlkZUxvZyIsIAogICAgICAgICAgICAgICAgbmFtZSA9ICJwZXB0aWRlTm9ybSIsIAogICAgICAgICAgICAgICAgbWV0aG9kID0gImNlbnRlci5tZWRpYW4iKQpgYGAKCjQuIFN1bW1hcml6YXRpb24KCmBgYHtyIHdhcm5pbmc9RkFMU0UsbWVzc2FnZT1GQUxTRX0KcGUgPC0gYWdncmVnYXRlRmVhdHVyZXMocGUsCiAgaSA9ICJwZXB0aWRlTm9ybSIsCiAgZmNvbCA9ICJQcm90ZWlucyIsCiAgbmEucm0gPSBUUlVFLAogIG5hbWUgPSAicHJvdGVpbiIpCmBgYAo8L3A+PC9kZXRhaWxzPgoKIyMgRWZmZWN0IHNpemU/IAoKYGBge3J9CmxpYnJhcnkoRXhwbG9yZU1vZGVsTWF0cml4KQpWaXN1YWxpemVEZXNpZ24oY29sRGF0YShwZSksZGVzaWduRm9ybXVsYSA9IH5wcm9nbm9zaXMpJHBsb3RsaXN0CmBgYAoKClxbClxiZWdpbnthcnJheX17cmNsY2x9CkVbWXxPUl0gJj0mIFxiZXRhXzBcXApFW1l8UERdICY9JiBcYmV0YV8wICsgXGJldGFfe1BEfVxcClxsb2dfMiBGQ197UEQtT1J9ICY9JiAgXGJldGFfMCArIFxiZXRhX3tQRH0gLSAgXGJldGFfMCAmPSZcYmV0YV97UER9ClxlbmR7YXJyYXl9ClxdCgoKIyMgU3RhdGlzdGljYWwgSW5mZXJlbmNlCgpXZSB3YW50IHRvIGZpbmQgcHJvdGVpbnMgdGhhdCBhcmUgZGlmZmVyZW50aWFsIGFidW5kYW50CgokXHJpZ2h0YXJyb3ckIHVzZSBhIHN0YXRpc3RpY2FsIHRlc3QgCgotICRIXzAkOiAkXGxvZ18yIEZDX3tQRC1PUn0gPSAwJCAgb3IgJFxiZXRhX3tQRH0gPSAwJAotICRIXzEkOiAkXGxvZ18yIEZDX3tQRC1PUn0gXG5lcSAwJCAgb3IgJFxiZXRhX3tQRH0gXG5lcSAwJAoKIyMgRXhwZXJpbWVudCB3aXRoIDMgdnMgMyBjb21wYXJpc29uCgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgdG8gaW5mZXJlbmNlIDwvc3VtbWFyeT48cD4KYGBge3IgbWVzc2FnZT1GQUxTRSx3YXJuaW5nPUZBTFNFfQpwZSA8LSBtc3Fyb2Iob2JqZWN0ID0gcGUsIGkgPSAicHJvdGVpbiIsIGZvcm11bGEgPSB+cHJvZ25vc2lzKQpMIDwtIG1ha2VDb250cmFzdCgicHJvZ25vc2lzUEQ9MCIsIHBhcmFtZXRlck5hbWVzID0gYygicHJvZ25vc2lzUEQiKSkKcGUgPC0gaHlwb3RoZXNpc1Rlc3Qob2JqZWN0ID0gcGUsIGkgPSAicHJvdGVpbiIsIGNvbnRyYXN0ID0gTCkKYGBgCgpgYGB7cn0Kdm9sY2FubzN4MyA8LSBnZ3Bsb3Qocm93RGF0YShwZVtbInByb3RlaW4iXV0pJHByb2dub3Npc1BEICU+JSBuYS5leGNsdWRlLAogICAgICAgICAgICAgICAgICBhZXMoeCA9IGxvZ0ZDLCB5ID0gLWxvZzEwKHB2YWwpLCBjb2xvciA9IGFkalB2YWwgPCAwLjA1KSkgKwogIGdlb21fcG9pbnQoY2V4ID0gMi41KSArCiAgc2NhbGVfY29sb3JfbWFudWFsKHZhbHVlcyA9IGFscGhhKGMoImJsYWNrIiwgInJlZCIpLCAwLjUpKSArIAogIHRoZW1lX21pbmltYWwoKSArCiAgZ2d0aXRsZShwYXN0ZTAoc3VtKHJvd0RhdGEocGVbWyJwcm90ZWluIl1dKSRwcm9nbm9zaXNQRCRhZGpQdmFsPDAuMDUsbmEucm09VFJVRSksIiBwcm90ZWlucyBhcmUgZm91bmQgdG8gYmUgREEiKSkKYGBgCgo8L3A+PC9kZXRhaWxzPgoKYGBge3J9CnZvbGNhbm8zeDMKYGBgCgpVcG9uIGNvcnJlY3Rpb24gZm9yIG11bHRpcGxlIHRlc3Rpbmcgd2l0aCB1c2luZyB0aGUgZmFsc2UgZGlzY292ZXJ5IHJhdGUgKEZEUikgbWV0aG9kIG5vIHByb3RlaW5zIGFyZSBmb3VuZCB0byBiZSBkaWZmZXJlbnRpYWxseSBleHByZXNzZWQuIAoKTm90ZSwgdGhhdCB5b3UgY2FuIHJlZnJlc2ggdGhlIGNvbmNlcHQgb2YgbXVsdGlwbGUgdGVzdGluZyBhbmQgRkRSIFtoZXJlXSAoaHR0cHM6Ly9zdGF0b21pY3MuZ2l0aHViLmlvL1BEQTIxL3BkYV9xdWFudGlmaWNhdGlvbl9pbmZlcmVuY2UuaHRtbCMxNF9NdWx0aXBsZV9oeXBvdGhlc2lzX3Rlc3RpbmcpLgoKIyMgRXhwZXJpbWVudCB3aXRoIGEgNiB2cyA2IGNvbXBhcmlzb24KCiMjIyBSZWFkIGRhdGEgCgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGJhY2tncm91bmQgYW5kIGNvZGUgPC9zdW1tYXJ5PjxwPgoxLiBXZSB1c2UgYSBwZXB0aWRlcy50eHQgZmlsZSBmcm9tIE1TLWRhdGEgcXVhbnRpZmllZCB3aXRoIG1heHF1YW50IHRoYXQgCmNvbnRhaW5zIE1TMSBpbnRlbnNpdGllcyBzdW1tYXJpemVkIGF0IHRoZSBwZXB0aWRlIGxldmVsLiAKYGBge3J9CnBlcHRpZGVzRmlsZSA8LSAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3N0YXRPbWljcy9wZGEyMS9kYXRhL3F1YW50aWZpY2F0aW9uL2NhbmNlci9wZXB0aWRlczZ2czYudHh0IgpgYGAKCjIuIE1heHF1YW50IHN0b3JlcyB0aGUgaW50ZW5zaXR5IGRhdGEgZm9yIHRoZSBkaWZmZXJlbnQgc2FtcGxlcyBpbiBjb2x1bW5ucyB0aGF0IHN0YXJ0IHdpdGggSW50ZW5zaXR5LiBXZSBjYW4gcmV0cmVpdmUgdGhlIGNvbHVtbiBuYW1lcyB3aXRoIHRoZSBpbnRlbnNpdHkgZGF0YSB3aXRoIHRoZSBjb2RlIGJlbG93OiAKCmBgYHtyfQplY29scyA8LSBncmVwKCJJbnRlbnNpdHlcXC4iLCBuYW1lcyhyZWFkLmRlbGltKHBlcHRpZGVzRmlsZSkpKQpgYGAKCjMuIFJlYWQgdGhlIGRhdGEgYW5kIHN0b3JlIGl0IGluICBRRmVhdHVyZXMgb2JqZWN0IAoKYGBge3J9CnBlIDwtIHJlYWRRRmVhdHVyZXMoCiAgdGFibGUgPSBwZXB0aWRlc0ZpbGUsCiAgZm5hbWVzID0gMSwKICBlY29sID0gZWNvbHMsCiAgbmFtZSA9ICJwZXB0aWRlUmF3Iiwgc2VwPSJcdCIpCmBgYAo8L3A+PC9kZXRhaWxzPgoKIyMjIERlc2lnbgoKPGRldGFpbHM+PHN1bW1hcnk+IENsaWNrIHRvIHNlZSBiYWNrZ3JvdW5kIGFuZCBjb2RlIDwvc3VtbWFyeT48cD4KCmBgYHtyfSAKcGUgJT4lIGNvbG5hbWVzCmBgYAoKLSBOb3RlLCB0aGF0IHRoZSBzYW1wbGUgbmFtZXMgdGhlIG91dGNvbWUuIAotIFdlIHVwZGF0ZSB0aGUgY29sRGF0YSB3aXRoIGluZm9ybWF0aW9uIG9uIHRoZSBkZXNpZ24KCmBgYHtyfQpjb2xEYXRhKHBlKSRwcm9nbm9zaXMgPC0gIHBlW1sicGVwdGlkZVJhdyJdXSAlPiUgCiAgY29sbmFtZXMgJT4lIAogIHN1YnN0cigxMSwxMikgJT4lIAogIGFzLmZhY3RvcgpgYGAKCi0gV2UgZXhwbG9yZSB0aGUgY29sRGF0YQoKYGBge3J9CmNvbERhdGEocGUpCmBgYAoKPC9wPjwvZGV0YWlscz4KCiMjIyBQcmVwcm9jZXNzaW5nCgoKPGRldGFpbHM+PHN1bW1hcnk+IENsaWNrIHRvIHNlZSBjb2RlIGZvciBwcmVwcm9jZXNzaW5nIDwvc3VtbWFyeT48cD4KCjEuIExvZy10cmFuc2Zvcm0KCi0gV2UgY2FsY3VsYXRlIGhvdyBtYW55IG5vbiB6ZXJvIGludGVuc2l0aWVzIHdlIGhhdmUgZm9yIGVhY2ggcGVwdGlkZSBhbmQgdGhpcyBjYW4gYmUgdXNlZnVsIGZvciBmaWx0ZXJpbmcuCgpgYGB7cn0Kcm93RGF0YShwZVtbInBlcHRpZGVSYXciXV0pJG5Ob25aZXJvIDwtIHJvd1N1bXMoYXNzYXkocGVbWyJwZXB0aWRlUmF3Il1dKSA+IDApCmBgYAoKCi0gUGVwdGlkZXMgd2l0aCB6ZXJvIGludGVuc2l0aWVzIGFyZSBtaXNzaW5nIHBlcHRpZGVzIGFuZCBzaG91bGQgYmUgcmVwcmVzZW50CndpdGggYSBgTkFgIHZhbHVlIHJhdGhlciB0aGFuIGAwYC4KCmBgYHtyfQpwZSA8LSB6ZXJvSXNOQShwZSwgInBlcHRpZGVSYXciKSAjIGNvbnZlcnQgMCB0byBOQQpgYGAKCi0gTG9ndHJhbnNmb3JtIGRhdGEgd2l0aCBiYXNlIDIKCmBgYHtyfQpwZSA8LSBsb2dUcmFuc2Zvcm0ocGUsIGJhc2UgPSAyLCBpID0gInBlcHRpZGVSYXciLCBuYW1lID0gInBlcHRpZGVMb2ciKQpgYGAKCjIuIEZpbHRlcmluZwoKPGRldGFpbHM+PHN1bW1hcnk+IENsaWNrIHRvIHNlZSBjb2RlIHRvIGZpbHRlciB0aGUgZGF0YSA8L3N1bW1hcnk+PHA+CgotIEhhbmRsaW5nIG92ZXJsYXBwaW5nIHByb3RlaW4gZ3JvdXBzCgpJbiBvdXIgYXBwcm9hY2ggYSBwZXB0aWRlIGNhbiBtYXAgdG8gbXVsdGlwbGUgcHJvdGVpbnMsIGFzIGxvbmcgYXMgdGhlcmUgaXMKbm9uZSBvZiB0aGVzZSBwcm90ZWlucyBwcmVzZW50IGluIGEgc21hbGxlciBzdWJncm91cC4KCmBgYHtyfQpwZSA8LSBmaWx0ZXJGZWF0dXJlcyhwZSwgfiBQcm90ZWlucyAlaW4lIHNtYWxsZXN0VW5pcXVlR3JvdXBzKHJvd0RhdGEocGVbWyJwZXB0aWRlTG9nIl1dKSRQcm90ZWlucykpCmBgYAoKLSBSZW1vdmUgcmV2ZXJzZSBzZXF1ZW5jZXMgKGRlY295cykgYW5kIGNvbnRhbWluYW50cwoKV2Ugbm93IHJlbW92ZSB0aGUgY29udGFtaW5hbnRzLCBwZXB0aWRlcyB0aGF0IG1hcCB0byBkZWNveSBzZXF1ZW5jZXMsIGFuZCBwcm90ZWlucwp3aGljaCB3ZXJlIG9ubHkgaWRlbnRpZmllZCBieSBwZXB0aWRlcyB3aXRoIG1vZGlmaWNhdGlvbnMuCgpgYGB7cn0KcGUgPC0gZmlsdGVyRmVhdHVyZXMocGUsflJldmVyc2UgIT0gIisiKQpwZSA8LSBmaWx0ZXJGZWF0dXJlcyhwZSx+IENvbnRhbWluYW50ICE9ICIrIikKYGBgCgotIERyb3AgcGVwdGlkZXMgdGhhdCB3ZXJlIG9ubHkgaWRlbnRpZmllZCBpbiBvbmUgc2FtcGxlCgpXZSBrZWVwIHBlcHRpZGVzIHRoYXQgd2VyZSBvYnNlcnZlZCBhdCBsYXN0IHR3aWNlLgoKYGBge3J9CnBlIDwtIGZpbHRlckZlYXR1cmVzKHBlLH4gbk5vblplcm8gPj0yKQpucm93KHBlW1sicGVwdGlkZUxvZyJdXSkKYGBgCgpXZSBrZWVwIGByIG5yb3cocGVbWyJwZXB0aWRlTG9nIl1dKWAgcGVwdGlkZXMgdXBvbiBmaWx0ZXJpbmcuCgozLiBOb3JtYWxpemF0aW9uIAoKYGBge3J9CnBlIDwtIG5vcm1hbGl6ZShwZSwgCiAgICAgICAgICAgICAgICBpID0gInBlcHRpZGVMb2ciLCAKICAgICAgICAgICAgICAgIG5hbWUgPSAicGVwdGlkZU5vcm0iLCAKICAgICAgICAgICAgICAgIG1ldGhvZCA9ICJjZW50ZXIubWVkaWFuIikKYGBgCgo0LiBTdW1tYXJpemF0aW9uCgpgYGB7ciB3YXJuaW5nPUZBTFNFLG1lc3NhZ2U9RkFMU0V9CnBlIDwtIGFnZ3JlZ2F0ZUZlYXR1cmVzKHBlLAogIGkgPSAicGVwdGlkZU5vcm0iLAogIGZjb2wgPSAiUHJvdGVpbnMiLAogIG5hLnJtID0gVFJVRSwKICBuYW1lID0gInByb3RlaW4iKQpgYGAKPC9wPjwvZGV0YWlscz4KCiMjIyBTdGF0aXN0aWNhbCBJbmZlcmVuY2UKCjxkZXRhaWxzPjxzdW1tYXJ5PiBDbGljayB0byBzZWUgY29kZSB0byBpbmZlcmVuY2UgPC9zdW1tYXJ5PjxwPgpgYGB7ciBtZXNzYWdlPUZBTFNFLHdhcm5pbmc9RkFMU0V9CnBlIDwtIG1zcXJvYihvYmplY3QgPSBwZSwgaSA9ICJwcm90ZWluIiwgZm9ybXVsYSA9IH5wcm9nbm9zaXMpCkwgPC0gbWFrZUNvbnRyYXN0KCJwcm9nbm9zaXNQRD0wIiwgcGFyYW1ldGVyTmFtZXMgPSBjKCJwcm9nbm9zaXNQRCIpKQpwZSA8LSBoeXBvdGhlc2lzVGVzdChvYmplY3QgPSBwZSwgaSA9ICJwcm90ZWluIiwgY29udHJhc3QgPSBMKQpgYGAKCmBgYHtyfQp2b2xjYW5vNng2IDwtIGdncGxvdChyb3dEYXRhKHBlW1sicHJvdGVpbiJdXSkkcHJvZ25vc2lzUEQgJT4lIG5hLmV4Y2x1ZGUsCiAgICAgICAgICAgICAgICAgIGFlcyh4ID0gbG9nRkMsIHkgPSAtbG9nMTAocHZhbCksIGNvbG9yID0gYWRqUHZhbCA8IDAuMDUpKSArCiAgZ2VvbV9wb2ludChjZXggPSAyLjUpICsKICBzY2FsZV9jb2xvcl9tYW51YWwodmFsdWVzID0gYWxwaGEoYygiYmxhY2siLCAicmVkIiksIDAuNSkpICsgCiAgdGhlbWVfbWluaW1hbCgpICsKICBnZ3RpdGxlKHBhc3RlMChzdW0ocm93RGF0YShwZVtbInByb3RlaW4iXV0pJHByb2dub3Npc1BEJGFkalB2YWw8MC4wNSxuYS5ybT1UUlVFKSwiIHByb3RlaW5zIGFyZSBmb3VuZCB0byBiZSBEQSIpKQpgYGAKPC9wPjwvZGV0YWlscz4KCgpgYGB7cn0Kdm9sY2FubzZ4NgpgYGAKCgojIyBFeHBlcmltZW50IHdpdGggYSA5IHZzIDkgY29tcGFyaXNvbgoKIyMjIFJlYWQgZGF0YSAKCjxkZXRhaWxzPjxzdW1tYXJ5PiBDbGljayB0byBzZWUgYmFja2dyb3VuZCBhbmQgY29kZSA8L3N1bW1hcnk+PHA+CjEuIFdlIHVzZSBhIHBlcHRpZGVzLnR4dCBmaWxlIGZyb20gTVMtZGF0YSBxdWFudGlmaWVkIHdpdGggbWF4cXVhbnQgdGhhdCAKY29udGFpbnMgTVMxIGludGVuc2l0aWVzIHN1bW1hcml6ZWQgYXQgdGhlIHBlcHRpZGUgbGV2ZWwuIApgYGB7cn0KcGVwdGlkZXNGaWxlIDwtICJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vc3RhdE9taWNzL3BkYTIxL2RhdGEvcXVhbnRpZmljYXRpb24vY2FuY2VyL3BlcHRpZGVzOXZzOS50eHQiCmBgYAoKMi4gTWF4cXVhbnQgc3RvcmVzIHRoZSBpbnRlbnNpdHkgZGF0YSBmb3IgdGhlIGRpZmZlcmVudCBzYW1wbGVzIGluIGNvbHVtbm5zIHRoYXQgc3RhcnQgd2l0aCBJbnRlbnNpdHkuIFdlIGNhbiByZXRyZWl2ZSB0aGUgY29sdW1uIG5hbWVzIHdpdGggdGhlIGludGVuc2l0eSBkYXRhIHdpdGggdGhlIGNvZGUgYmVsb3c6IAoKYGBge3J9CmVjb2xzIDwtIGdyZXAoIkludGVuc2l0eVxcLiIsIG5hbWVzKHJlYWQuZGVsaW0ocGVwdGlkZXNGaWxlKSkpCmBgYAoKMy4gUmVhZCB0aGUgZGF0YSBhbmQgc3RvcmUgaXQgaW4gIFFGZWF0dXJlcyBvYmplY3QgCgpgYGB7cn0KcGUgPC0gcmVhZFFGZWF0dXJlcygKICB0YWJsZSA9IHBlcHRpZGVzRmlsZSwKICBmbmFtZXMgPSAxLAogIGVjb2wgPSBlY29scywKICBuYW1lID0gInBlcHRpZGVSYXciLCBzZXA9Ilx0IikKYGBgCjwvcD48L2RldGFpbHM+CgojIyMgRGVzaWduCgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGJhY2tncm91bmQgYW5kIGNvZGUgPC9zdW1tYXJ5PjxwPgoKYGBge3J9IApwZSAlPiUgY29sbmFtZXMKYGBgCgotIE5vdGUsIHRoYXQgdGhlIHNhbXBsZSBuYW1lcyB0aGUgb3V0Y29tZS4gCi0gV2UgdXBkYXRlIHRoZSBjb2xEYXRhIHdpdGggaW5mb3JtYXRpb24gb24gdGhlIGRlc2lnbgoKYGBge3J9CmNvbERhdGEocGUpJHByb2dub3NpcyA8LSAgcGVbWyJwZXB0aWRlUmF3Il1dICU+JSAKICBjb2xuYW1lcyAlPiUgCiAgc3Vic3RyKDExLDEyKSAlPiUgCiAgYXMuZmFjdG9yCmBgYAoKLSBXZSBleHBsb3JlIHRoZSBjb2xEYXRhCgpgYGB7cn0KY29sRGF0YShwZSkKYGBgCgo8L3A+PC9kZXRhaWxzPgoKIyMjIFByZXByb2Nlc3NpbmcKCgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgZm9yIHByZXByb2Nlc3NpbmcgPC9zdW1tYXJ5PjxwPgoKMS4gTG9nLXRyYW5zZm9ybQoKLSBXZSBjYWxjdWxhdGUgaG93IG1hbnkgbm9uIHplcm8gaW50ZW5zaXRpZXMgd2UgaGF2ZSBmb3IgZWFjaCBwZXB0aWRlIGFuZCB0aGlzIGNhbiBiZSB1c2VmdWwgZm9yIGZpbHRlcmluZy4KCmBgYHtyfQpyb3dEYXRhKHBlW1sicGVwdGlkZVJhdyJdXSkkbk5vblplcm8gPC0gcm93U3Vtcyhhc3NheShwZVtbInBlcHRpZGVSYXciXV0pID4gMCkKYGBgCgoKLSBQZXB0aWRlcyB3aXRoIHplcm8gaW50ZW5zaXRpZXMgYXJlIG1pc3NpbmcgcGVwdGlkZXMgYW5kIHNob3VsZCBiZSByZXByZXNlbnQKd2l0aCBhIGBOQWAgdmFsdWUgcmF0aGVyIHRoYW4gYDBgLgoKYGBge3J9CnBlIDwtIHplcm9Jc05BKHBlLCAicGVwdGlkZVJhdyIpICMgY29udmVydCAwIHRvIE5BCmBgYAoKLSBMb2d0cmFuc2Zvcm0gZGF0YSB3aXRoIGJhc2UgMgoKYGBge3J9CnBlIDwtIGxvZ1RyYW5zZm9ybShwZSwgYmFzZSA9IDIsIGkgPSAicGVwdGlkZVJhdyIsIG5hbWUgPSAicGVwdGlkZUxvZyIpCmBgYAoKMi4gRmlsdGVyaW5nCgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgdG8gZmlsdGVyIHRoZSBkYXRhIDwvc3VtbWFyeT48cD4KCi0gSGFuZGxpbmcgb3ZlcmxhcHBpbmcgcHJvdGVpbiBncm91cHMKCkluIG91ciBhcHByb2FjaCBhIHBlcHRpZGUgY2FuIG1hcCB0byBtdWx0aXBsZSBwcm90ZWlucywgYXMgbG9uZyBhcyB0aGVyZSBpcwpub25lIG9mIHRoZXNlIHByb3RlaW5zIHByZXNlbnQgaW4gYSBzbWFsbGVyIHN1Ymdyb3VwLgoKYGBge3J9CnBlIDwtIGZpbHRlckZlYXR1cmVzKHBlLCB+IFByb3RlaW5zICVpbiUgc21hbGxlc3RVbmlxdWVHcm91cHMocm93RGF0YShwZVtbInBlcHRpZGVMb2ciXV0pJFByb3RlaW5zKSkKYGBgCgotIFJlbW92ZSByZXZlcnNlIHNlcXVlbmNlcyAoZGVjb3lzKSBhbmQgY29udGFtaW5hbnRzCgpXZSBub3cgcmVtb3ZlIHRoZSBjb250YW1pbmFudHMsIHBlcHRpZGVzIHRoYXQgbWFwIHRvIGRlY295IHNlcXVlbmNlcywgYW5kIHByb3RlaW5zCndoaWNoIHdlcmUgb25seSBpZGVudGlmaWVkIGJ5IHBlcHRpZGVzIHdpdGggbW9kaWZpY2F0aW9ucy4KCmBgYHtyfQpwZSA8LSBmaWx0ZXJGZWF0dXJlcyhwZSx+UmV2ZXJzZSAhPSAiKyIpCnBlIDwtIGZpbHRlckZlYXR1cmVzKHBlLH4gQ29udGFtaW5hbnQgIT0gIisiKQpgYGAKCi0gRHJvcCBwZXB0aWRlcyB0aGF0IHdlcmUgb25seSBpZGVudGlmaWVkIGluIG9uZSBzYW1wbGUKCldlIGtlZXAgcGVwdGlkZXMgdGhhdCB3ZXJlIG9ic2VydmVkIGF0IGxhc3QgdHdpY2UuCgpgYGB7cn0KcGUgPC0gZmlsdGVyRmVhdHVyZXMocGUsfiBuTm9uWmVybyA+PTIpCm5yb3cocGVbWyJwZXB0aWRlTG9nIl1dKQpgYGAKCldlIGtlZXAgYHIgbnJvdyhwZVtbInBlcHRpZGVMb2ciXV0pYCBwZXB0aWRlcyB1cG9uIGZpbHRlcmluZy4KCjMuIE5vcm1hbGl6YXRpb24gCgpgYGB7cn0KcGUgPC0gbm9ybWFsaXplKHBlLCAKICAgICAgICAgICAgICAgIGkgPSAicGVwdGlkZUxvZyIsIAogICAgICAgICAgICAgICAgbmFtZSA9ICJwZXB0aWRlTm9ybSIsIAogICAgICAgICAgICAgICAgbWV0aG9kID0gImNlbnRlci5tZWRpYW4iKQpgYGAKCjQuIFN1bW1hcml6YXRpb24KCmBgYHtyIHdhcm5pbmc9RkFMU0UsbWVzc2FnZT1GQUxTRX0KcGUgPC0gYWdncmVnYXRlRmVhdHVyZXMocGUsCiAgaSA9ICJwZXB0aWRlTm9ybSIsCiAgZmNvbCA9ICJQcm90ZWlucyIsCiAgbmEucm0gPSBUUlVFLAogIG5hbWUgPSAicHJvdGVpbiIpCmBgYAo8L3A+PC9kZXRhaWxzPgoKIyMjIFN0YXRpc3RpY2FsIEluZmVyZW5jZQoKPGRldGFpbHM+PHN1bW1hcnk+IENsaWNrIHRvIHNlZSBjb2RlIHRvIGluZmVyZW5jZSA8L3N1bW1hcnk+PHA+CmBgYHtyIG1lc3NhZ2U9RkFMU0Usd2FybmluZz1GQUxTRX0KcGUgPC0gbXNxcm9iKG9iamVjdCA9IHBlLCBpID0gInByb3RlaW4iLCBmb3JtdWxhID0gfnByb2dub3NpcykKTCA8LSBtYWtlQ29udHJhc3QoInByb2dub3Npc1BEPTAiLCBwYXJhbWV0ZXJOYW1lcyA9IGMoInByb2dub3Npc1BEIikpCnBlIDwtIGh5cG90aGVzaXNUZXN0KG9iamVjdCA9IHBlLCBpID0gInByb3RlaW4iLCBjb250cmFzdCA9IEwpCmBgYAoKYGBge3J9CnZvbGNhbm85eDkgPC0gZ2dwbG90KHJvd0RhdGEocGVbWyJwcm90ZWluIl1dKSRwcm9nbm9zaXNQRCAlPiUgbmEuZXhjbHVkZSwKICAgICAgICAgICAgICAgICAgYWVzKHggPSBsb2dGQywgeSA9IC1sb2cxMChwdmFsKSwgY29sb3IgPSBhZGpQdmFsIDwgMC4wNSkpICsKICBnZW9tX3BvaW50KGNleCA9IDIuNSkgKwogIHNjYWxlX2NvbG9yX21hbnVhbCh2YWx1ZXMgPSBhbHBoYShjKCJibGFjayIsICJyZWQiKSwgMC41KSkgKyAKICB0aGVtZV9taW5pbWFsKCkgKwogIGdndGl0bGUocGFzdGUwKHN1bShyb3dEYXRhKHBlW1sicHJvdGVpbiJdXSkkcHJvZ25vc2lzUEQkYWRqUHZhbDwwLjA1LG5hLnJtPVRSVUUpLCIgcHJvdGVpbnMgYXJlIGZvdW5kIHRvIGJlIERBIikpCmBgYAo8L3A+PC9kZXRhaWxzPgoKCmBgYHtyfQp2b2xjYW5vOXg5CmBgYAoKLSBXZSBoYXZlIHNlZW4gdGhhdCB0aGUgc2FtcGxlIHNpemUgaXMga2V5IHRvIHJlY292ZXIgREEgcHJvdGVpbnMKCi0gSW5kZWVkLCBpZiBhIHByb3RlaW4gaXMgZGlmZmVyZW50aWFsbHkgZXhwcmVzc2VkLCB0aGUgdmFsdWUgb2YgVC10ZXN0IGRlcGVuZHMgb24gdGhlIGVmZmVjdCBzaXplLCB0aGUgdmFyaWFiaWxpdHkgb2YgdGhlIHByb3RlaW4gZXhwcmVzc2lvbiB2YWx1ZXMgYW5kIHRoZSBzYW1wbGUgc2l6ZS4gCgokJApUX2c9XGZyYWN7XGxvZ18yIFx0ZXh0e0ZDfX17XHRleHR7c2V9X3tcbG9nXzIgXHRleHR7RkN9fX0KJCQKCiQkClRfZz1cZnJhY3tcd2lkZWhhdHtcdGV4dHtzaWduYWx9fX17XHdpZGVoYXR7XHRleHR7Tm9pc2V9fX0KJCQKCkZvciBhIHR3byBncm91cCBjb21wYXJpc29uIHRoZSBzdGFuZGFyZCBlcnJvciBvbiB0aGUgZm9sZCBjaGFuZ2UgZXF1YWxzCgokJApcdGV4dHtzZX1fe1xsb2dfMiBcdGV4dHtGQ319PVx0ZXh0e1NEfVxzcXJ0e1xmcmFjezF9e25fMX0rXGZyYWN7MX17bl8yfX0KJCQKCiRccmlnaHRhcnJvdyQgaWYgbnVtYmVyIG9mIGJpby1yZXBlYXRzIGluY3JlYXNlcyB3ZSBoYXZlIGEgaGlnaGVyIHBvd2VyIQoKCiMgUmFuZG9taXplZCBjb21wbGV0ZSBibG9jayBkZXNpZ25zCgpcW1xzaWdtYV4yPSBcc2lnbWFeMl97YmlvfStcc2lnbWFeMl9cdGV4dHtsYWJ9ICtcc2lnbWFeMl9cdGV4dHtleHRyYWN0aW9ufSArIFxzaWdtYV4yX1x0ZXh0e3J1bn0gKyBcbGRvdHNcXQoKLSBCaW9sb2dpY2FsOiBmbHVjdHVhdGlvbnMgaW4gcHJvdGVpbiBsZXZlbCBiZXR3ZWVuIG1pY2UsIGZsdWN0YXRpb25zIGluIHByb3RlaW4gbGV2ZWwgYmV0d2VlbiBjZWxscywgLi4uCi0gVGVjaG5pY2FsOiBjYWdlIGVmZmVjdCwgbGFiIGVmZmVjdCwgd2VlayBlZmZlY3QsIHBsYXNtYSBleHRyYWN0aW9uLCBNUy1ydW4sIC4uLgoKIyMgTmF0dXJlIG1ldGhvZHM6IFBvaW50cyBvZiBzaWduaWZpY2FuY2UgLSBCbG9ja2luZyAKCltodHRwczovL3d3dy5uYXR1cmUuY29tL2FydGljbGVzL25tZXRoLjMwMDUucGRmXShodHRwczovL3d3dy5uYXR1cmUuY29tL2FydGljbGVzL25tZXRoLjMwMDUucGRmKQoKCiMjIE1vdXNlIGV4YW1wbGUgCgoKYGBge3IgZWNobz1GQUxTRSwgb3V0LndpZHRoPSI1MCUifQprbml0cjo6aW5jbHVkZV9ncmFwaGljcygiLi9maWd1cmVzL21vdXNlVGNlbGxfUkNCX2Rlc2lnbi5wbmciKQpgYGAKCkR1Z3VldCBldCBhbC4gKDIwMTcpIE1DUCAxNig4KToxNDE2LTE0MzIuIGRvaTogMTAuMTA3NC9tY3AubTExNi4wNjI3NDUKCi0gQWxsIHRyZWF0bWVudHMgb2YgaW50ZXJlc3QgYXJlIHByZXNlbnQgd2l0aGluIGJsb2NrIQotIFdlIGNhbiBlc3RpbWF0ZSB0aGUgZWZmZWN0IG9mIHRoZSB0cmVhdG1lbnQgd2l0aGluIGJsb2NrIQoKVG8gaWxsdXN0cmF0ZSB0aGUgcG93ZXIgb2YgYmxvY2tpbmcgd2UgaGF2ZSBzdWJzZXR0ZWQgdGhlIGRhdGEgb2YgRHVndWV0IGV0IGFsLiBpbiBhIAoKLSBjb21wbGV0ZWx5IHJhbmRvbWl6ZWQgZGVzaWduIHdpdGggCiAgICAtIGZvdXIgbWljZSBmb3Igd2hpY2ggd2Ugb25seSBoYXZlIG1lYXN1cmVtZW50cyBvbiB0aGUgb3JkaW5hcnkgVC1jZWxscyAKICAgIC0gZm91ciBtaWNlIGZvciB3aGljaCB3ZSBvbmx5IGhhdmUgbWVhc3VyZW1lbnRzIG9uIHRoZSByZWd1bGF0b3J5IFQtY2VsbHMgCiAgICAKLSByYW5kb21pemVkIGNvbXBsZXRlIGJsb2NrIGRlc2lnbiB3aXRoIGZvdXIgbWljZSBmb3Igd2hpY2ggd2UgYm90aCBoYXZlCiAgICAKICAgIC0gbWVhc3VyZW1lbnRzIG9uIG9yZGluYXJ5IFQtY2VsbHMgYXMgd2VsbCBhcwogICAgLSBtZWFzdXJlbWVudHMgb24gcmVndWxhdG9yeSBULWNlbGxzCgoKCgojIyMgRGF0YSAKPGRldGFpbHM+PHN1bW1hcnk+IENsaWNrIHRvIHNlZSBjb2RlICA8L3N1bW1hcnk+PHA+CmBgYHtyLCB3YXJuaW5nPUZBTFNFLCBtZXNzYWdlPUZBTFNFfQpsaWJyYXJ5KHRpZHl2ZXJzZSkKbGlicmFyeShsaW1tYSkKbGlicmFyeShRRmVhdHVyZXMpCmxpYnJhcnkobXNxcm9iMikKbGlicmFyeShwbG90bHkpCmxpYnJhcnkoZ3JpZEV4dHJhKQoKcGVwdGlkZXNGaWxlIDwtICJodHRwczovL3Jhdy5naXRodWJ1c2VyY29udGVudC5jb20vc3RhdE9taWNzL1BEQTIxL2RhdGEvcXVhbnRpZmljYXRpb24vbW91c2VUY2VsbC9wZXB0aWRlc1JDQi50eHQiCnBlcHRpZGVzRmlsZTIgPC0gImh0dHBzOi8vcmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbS9zdGF0T21pY3MvUERBMjEvZGF0YS9xdWFudGlmaWNhdGlvbi9tb3VzZVRjZWxsL3BlcHRpZGVzQ1JELnR4dCIKcGVwdGlkZXNGaWxlMyA8LSAiaHR0cHM6Ly9yYXcuZ2l0aHVidXNlcmNvbnRlbnQuY29tL3N0YXRPbWljcy9QREEyMS9kYXRhL3F1YW50aWZpY2F0aW9uL21vdXNlVGNlbGwvcGVwdGlkZXMudHh0IgoKZWNvbHMgPC0gZ3JlcCgiSW50ZW5zaXR5XFwuIiwgbmFtZXMocmVhZC5kZWxpbShwZXB0aWRlc0ZpbGUpKSkKcGUgPC0gcmVhZFFGZWF0dXJlcygKICB0YWJsZSA9IHBlcHRpZGVzRmlsZSwKICBmbmFtZXMgPSAxLAogIGVjb2wgPSBlY29scywKICBuYW1lID0gInBlcHRpZGVSYXciLCBzZXA9Ilx0IikKCmVjb2xzMiA8LSBncmVwKCJJbnRlbnNpdHlcXC4iLCBuYW1lcyhyZWFkLmRlbGltKHBlcHRpZGVzRmlsZTIpKSkKcGUyIDwtIHJlYWRRRmVhdHVyZXMoCiAgdGFibGUgPSBwZXB0aWRlc0ZpbGUyLAogIGZuYW1lcyA9IDEsCiAgZWNvbCA9IGVjb2xzMiwKICBuYW1lID0gInBlcHRpZGVSYXciLCBzZXA9Ilx0IikKCmVjb2xzMyA8LSBncmVwKCJJbnRlbnNpdHlcXC4iLCBuYW1lcyhyZWFkLmRlbGltKHBlcHRpZGVzRmlsZTMpKSkKcGUzIDwtIHJlYWRRRmVhdHVyZXMoCiAgdGFibGUgPSBwZXB0aWRlc0ZpbGUzLAogIGZuYW1lcyA9IDEsCiAgZWNvbCA9IGVjb2xzMywKICBuYW1lID0gInBlcHRpZGVSYXciLCBzZXA9Ilx0IikKCiMjIyBEZXNpZ24KY29sRGF0YShwZSkkY2VsbHR5cGUgPC0gc3Vic3RyKAogIGNvbG5hbWVzKHBlW1sicGVwdGlkZVJhdyJdXSksCiAgMTEsCiAgMTQpICU+JQogIHVubGlzdCAlPiUgIAogIGFzLmZhY3RvcgoKY29sRGF0YShwZSkkbW91c2UgPC0gcGVbWzFdXSAlPiUKICBjb2xuYW1lcyAlPiUKICBzdHJzcGxpdChzcGxpdD0iWy5dIikgICU+JQogIHNhcHBseShmdW5jdGlvbih4KSB4WzNdKSAlPiUKICBhcy5mYWN0b3IKCmNvbERhdGEocGUyKSRjZWxsdHlwZSA8LSBzdWJzdHIoCiAgY29sbmFtZXMocGUyW1sicGVwdGlkZVJhdyJdXSksCiAgMTEsCiAgMTQpICU+JQogIHVubGlzdCAlPiUgIAogIGFzLmZhY3RvcgoKY29sRGF0YShwZTIpJG1vdXNlIDwtIHBlMltbMV1dICU+JQogIGNvbG5hbWVzICU+JQogIHN0cnNwbGl0KHNwbGl0PSJbLl0iKSAgJT4lCiAgc2FwcGx5KGZ1bmN0aW9uKHgpIHhbM10pICU+JQogIGFzLmZhY3RvcgoKY29sRGF0YShwZTMpJGNlbGx0eXBlIDwtIHN1YnN0cigKICBjb2xuYW1lcyhwZTNbWyJwZXB0aWRlUmF3Il1dKSwKICAxMSwKICAxNCkgJT4lCiAgdW5saXN0ICU+JSAgCiAgYXMuZmFjdG9yCgpjb2xEYXRhKHBlMykkbW91c2UgPC0gcGUzW1sxXV0gJT4lCiAgY29sbmFtZXMgJT4lCiAgc3Ryc3BsaXQoc3BsaXQ9IlsuXSIpICAlPiUKICBzYXBwbHkoZnVuY3Rpb24oeCkgeFszXSkgJT4lCiAgYXMuZmFjdG9yCmBgYAo8L3A+PC9kZXNpZ24+CgojIyMgUHJlcHJvY2Vzc2luZyAKCgojIyMjIExvZy10cmFuc2Zvcm0KCjxkZXRhaWxzPjxzdW1tYXJ5PiBDbGljayB0byBzZWUgY29kZSB0byBsb2ctdHJhbnNmcm9tIHRoZSBkYXRhIDwvc3VtbWFyeT48cD4KLSBXZSBjYWxjdWxhdGUgaG93IG1hbnkgbm9uIHplcm8gaW50ZW5zaXRpZXMgd2UgaGF2ZSBmb3IgZWFjaCBwZXB0aWRlIGFuZCB0aGlzIGNhbiBiZSB1c2VmdWwgZm9yIGZpbHRlcmluZy4KCmBgYHtyfQpyb3dEYXRhKHBlW1sicGVwdGlkZVJhdyJdXSkkbk5vblplcm8gPC0gcm93U3Vtcyhhc3NheShwZVtbInBlcHRpZGVSYXciXV0pID4gMCkKCnJvd0RhdGEocGUyW1sicGVwdGlkZVJhdyJdXSkkbk5vblplcm8gPC0gcm93U3Vtcyhhc3NheShwZTJbWyJwZXB0aWRlUmF3Il1dKSA+IDApCgpyb3dEYXRhKHBlM1tbInBlcHRpZGVSYXciXV0pJG5Ob25aZXJvIDwtIHJvd1N1bXMoYXNzYXkocGUzW1sicGVwdGlkZVJhdyJdXSkgPiAwKQpgYGAKCi0gUGVwdGlkZXMgd2l0aCB6ZXJvIGludGVuc2l0aWVzIGFyZSBtaXNzaW5nIHBlcHRpZGVzIGFuZCBzaG91bGQgYmUgcmVwcmVzZW50CndpdGggYSBgTkFgIHZhbHVlIHJhdGhlciB0aGFuIGAwYC4KCmBgYHtyfQpwZSA8LSB6ZXJvSXNOQShwZSwgInBlcHRpZGVSYXciKSAjIGNvbnZlcnQgMCB0byBOQQoKcGUyIDwtIHplcm9Jc05BKHBlMiwgInBlcHRpZGVSYXciKSAjIGNvbnZlcnQgMCB0byBOQQoKcGUzIDwtIHplcm9Jc05BKHBlMywgInBlcHRpZGVSYXciKSAjIGNvbnZlcnQgMCB0byBOQQpgYGAKCi0gTG9ndHJhbnNmb3JtIGRhdGEgd2l0aCBiYXNlIDIKCmBgYHtyfQpwZSA8LSBsb2dUcmFuc2Zvcm0ocGUsIGJhc2UgPSAyLCBpID0gInBlcHRpZGVSYXciLCBuYW1lID0gInBlcHRpZGVMb2ciKQoKcGUyIDwtIGxvZ1RyYW5zZm9ybShwZTIsIGJhc2UgPSAyLCBpID0gInBlcHRpZGVSYXciLCBuYW1lID0gInBlcHRpZGVMb2ciKQoKcGUzIDwtIGxvZ1RyYW5zZm9ybShwZTMsIGJhc2UgPSAyLCBpID0gInBlcHRpZGVSYXciLCBuYW1lID0gInBlcHRpZGVMb2ciKQpgYGAKPC9wPjwvZGV0YWlscz4KCgojIyMjIEZpbHRlcmluZwo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGRldGFpbHMgb24gZmlsdGVyaW5nIDwvc3VtbWFyeT48cD4KCjEuIEhhbmRsaW5nIG92ZXJsYXBwaW5nIHByb3RlaW4gZ3JvdXBzCgpJbiBvdXIgYXBwcm9hY2ggYSBwZXB0aWRlIGNhbiBtYXAgdG8gbXVsdGlwbGUgcHJvdGVpbnMsIGFzIGxvbmcgYXMgdGhlcmUgaXMKbm9uZSBvZiB0aGVzZSBwcm90ZWlucyBwcmVzZW50IGluIGEgc21hbGxlciBzdWJncm91cC4KCmBgYHtyfQpwZSA8LSBmaWx0ZXJGZWF0dXJlcyhwZSwgfiBQcm90ZWlucyAlaW4lIHNtYWxsZXN0VW5pcXVlR3JvdXBzKHJvd0RhdGEocGVbWyJwZXB0aWRlTG9nIl1dKSRQcm90ZWlucykpCgpwZTIgPC0gZmlsdGVyRmVhdHVyZXMocGUyLCB+IFByb3RlaW5zICVpbiUgc21hbGxlc3RVbmlxdWVHcm91cHMocm93RGF0YShwZTJbWyJwZXB0aWRlTG9nIl1dKSRQcm90ZWlucykpCgpwZTMgPC0gZmlsdGVyRmVhdHVyZXMocGUzLCB+IFByb3RlaW5zICVpbiUgc21hbGxlc3RVbmlxdWVHcm91cHMocm93RGF0YShwZTNbWyJwZXB0aWRlTG9nIl1dKSRQcm90ZWlucykpCmBgYAoyLiBSZW1vdmUgcmV2ZXJzZSBzZXF1ZW5jZXMgKGRlY295cykgYW5kIGNvbnRhbWluYW50cwoKV2Ugbm93IHJlbW92ZSB0aGUgY29udGFtaW5hbnRzLCBwZXB0aWRlcyB0aGF0IG1hcCB0byBkZWNveSBzZXF1ZW5jZXMsIGFuZCBwcm90ZWlucwp3aGljaCB3ZXJlIG9ubHkgaWRlbnRpZmllZCBieSBwZXB0aWRlcyB3aXRoIG1vZGlmaWNhdGlvbnMuCgpgYGB7cn0KcGUgPC0gZmlsdGVyRmVhdHVyZXMocGUsflJldmVyc2UgIT0gIisiKQpwZSA8LSBmaWx0ZXJGZWF0dXJlcyhwZSx+IFBvdGVudGlhbC5jb250YW1pbmFudCAhPSAiKyIpCgpwZTIgPC0gZmlsdGVyRmVhdHVyZXMocGUyLH5SZXZlcnNlICE9ICIrIikKcGUyIDwtIGZpbHRlckZlYXR1cmVzKHBlMix+IFBvdGVudGlhbC5jb250YW1pbmFudCAhPSAiKyIpCgpwZTMgPC0gZmlsdGVyRmVhdHVyZXMocGUzLH5SZXZlcnNlICE9ICIrIikKcGUzIDwtIGZpbHRlckZlYXR1cmVzKHBlMyx+IFBvdGVudGlhbC5jb250YW1pbmFudCAhPSAiKyIpCmBgYAoKCjMuIERyb3AgcGVwdGlkZXMgdGhhdCB3ZXJlIG9ubHkgaWRlbnRpZmllZCBpbiBvbmUgc2FtcGxlCgpXZSBrZWVwIHBlcHRpZGVzIHRoYXQgd2VyZSBvYnNlcnZlZCBhdCBsYXN0IHR3aWNlLgoKYGBge3J9CnBlIDwtIGZpbHRlckZlYXR1cmVzKHBlLH4gbk5vblplcm8gPj0yKQpucm93KHBlW1sicGVwdGlkZUxvZyJdXSkKCnBlMiA8LSBmaWx0ZXJGZWF0dXJlcyhwZTIsfiBuTm9uWmVybyA+PTIpCm5yb3cocGUyW1sicGVwdGlkZUxvZyJdXSkKCnBlMyA8LSBmaWx0ZXJGZWF0dXJlcyhwZTMsfiBuTm9uWmVybyA+PTIpCm5yb3cocGUzW1sicGVwdGlkZUxvZyJdXSkKYGBgCgo8L3A+PC9kZXRhaWxzPgoKIyMjIyBOb3JtYWxpemF0aW9uIAoKPGRldGFpbHM+PHN1bW1hcnk+IENsaWNrIHRvIHNlZSBjb2RlIHRvIG5vcm1hbGl6ZSB0aGUgZGF0YSA8L3N1bW1hcnk+PHA+CmBgYHtyfQpwZSA8LSBub3JtYWxpemUocGUsIAogICAgICAgICAgICAgICAgaSA9ICJwZXB0aWRlTG9nIiwgCiAgICAgICAgICAgICAgICBuYW1lID0gInBlcHRpZGVOb3JtIiwgCiAgICAgICAgICAgICAgICBtZXRob2QgPSAiY2VudGVyLm1lZGlhbiIpCgpwZTIgPC0gbm9ybWFsaXplKHBlMiwgCiAgICAgICAgICAgICAgICBpID0gInBlcHRpZGVMb2ciLCAKICAgICAgICAgICAgICAgIG5hbWUgPSAicGVwdGlkZU5vcm0iLCAKICAgICAgICAgICAgICAgIG1ldGhvZCA9ICJjZW50ZXIubWVkaWFuIikKCgpwZTMgPC0gbm9ybWFsaXplKHBlMywgCiAgICAgICAgICAgICAgICBpID0gInBlcHRpZGVMb2ciLCAKICAgICAgICAgICAgICAgIG5hbWUgPSAicGVwdGlkZU5vcm0iLCAKICAgICAgICAgICAgICAgIG1ldGhvZCA9ICJjZW50ZXIubWVkaWFuIikKYGBgCgo8L3A+PC9kZXRhaWxzPgoKIyMjIyBTdW1tYXJpemF0aW9uCgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgdG8gc3VtbWFyaXplIHRoZSBkYXRhIDwvc3VtbWFyeT48cD4KCmBgYHtyLHdhcm5pbmc9RkFMU0V9CnBlIDwtIGFnZ3JlZ2F0ZUZlYXR1cmVzKHBlLAogaSA9ICJwZXB0aWRlTm9ybSIsCiBmY29sID0gIlByb3RlaW5zIiwKIG5hLnJtID0gVFJVRSwKIG5hbWUgPSAicHJvdGVpbiIpCgoKcGUyIDwtIGFnZ3JlZ2F0ZUZlYXR1cmVzKHBlMiwKIGkgPSAicGVwdGlkZU5vcm0iLAogZmNvbCA9ICJQcm90ZWlucyIsCiBuYS5ybSA9IFRSVUUsCiBuYW1lID0gInByb3RlaW4iKQoKcGUzIDwtIGFnZ3JlZ2F0ZUZlYXR1cmVzKHBlMywKIGkgPSAicGVwdGlkZU5vcm0iLAogZmNvbCA9ICJQcm90ZWlucyIsCiBuYS5ybSA9IFRSVUUsCiBuYW1lID0gInByb3RlaW4iKQpgYGAKCjwvcD48L2RldGFpbHM+CgojIyMgRGF0YSBFeHBsb3JhdGlvbjogd2hhdCBpcyBpbXBhY3Qgb2YgYmxvY2tpbmc/IAoKPGRldGFpbHM+PHN1bW1hcnk+IENsaWNrIHRvIHNlZSBjb2RlIDwvc3VtbWFyeT48cD4KYGBge3J9CmxldmVscyhjb2xEYXRhKHBlMykkbW91c2UpIDwtIHBhc3RlMCgibSIsMTo3KQptZHNPYmozIDwtIHBsb3RNRFMoYXNzYXkocGUzW1sicHJvdGVpbiJdXSksIHBsb3QgPSBGQUxTRSkKbWRzT3JpZyA8LSBjb2xEYXRhKHBlMykgJT4lCiAgYXMuZGF0YS5mcmFtZSAlPiUKICBtdXRhdGUobWRzMSA9IG1kc09iajMkeCwKICAgICAgICAgbWRzMiA9IG1kc09iajMkeSwKICAgICAgICAgbGFiID0gcGFzdGUobW91c2UsY2VsbHR5cGUsc2VwPSJfIikpICU+JQogIGdncGxvdChhZXMoeCA9IG1kczEsIHkgPSBtZHMyLCBsYWJlbCA9IGxhYiwgY29sb3IgPSBjZWxsdHlwZSwgZ3JvdXAgPSBtb3VzZSkpICsKICBnZW9tX3RleHQoc2hvdy5sZWdlbmQgPSBGQUxTRSkgKwogIGdlb21fcG9pbnQoc2hhcGUgPSAyMSkgKwogIGdlb21fbGluZShjb2xvciA9ICJibGFjayIsIGxpbmV0eXBlID0gImRhc2hlZCIpICsKICB4bGFiKAogICAgcGFzdGUwKAogICAgICBtZHNPYmozJGF4aXNsYWJlbCwKICAgICAgIiAiLAogICAgICAxLCAKICAgICAgIiAoIiwKICAgICAgcGFzdGUwKAogICAgICAgIHJvdW5kKG1kc09iajMkdmFyLmV4cGxhaW5lZFsxXSAqMTAwLDApLAogICAgICAgICIlIgogICAgICAgICksCiAgICAgICIpIgogICAgICApCiAgICApICsKICB5bGFiKAogICAgcGFzdGUwKAogICAgICBtZHNPYmozJGF4aXNsYWJlbCwKICAgICAgIiAiLAogICAgICAyLCAKICAgICAgIiAoIiwKICAgICAgcGFzdGUwKAogICAgICAgIHJvdW5kKG1kc09iajMkdmFyLmV4cGxhaW5lZFsyXSAqMTAwLDApLAogICAgICAgICIlIgogICAgICAgICksCiAgICAgICIpIgogICAgICApCiAgICApICsKICBnZ3RpdGxlKCJPcmlnaW5hbCAoUkNCKSIpCgpsZXZlbHMoY29sRGF0YShwZSkkbW91c2UpIDwtIHBhc3RlMCgibSIsMTo0KQptZHNPYmogPC0gcGxvdE1EUyhhc3NheShwZVtbInByb3RlaW4iXV0pLCBwbG90ID0gRkFMU0UpCm1kc1JDQiA8LSBjb2xEYXRhKHBlKSAlPiUKICBhcy5kYXRhLmZyYW1lICU+JQogIG11dGF0ZShtZHMxID0gbWRzT2JqJHgsCiAgICAgICAgIG1kczIgPSBtZHNPYmokeSwKICAgICAgICAgbGFiID0gcGFzdGUobW91c2UsY2VsbHR5cGUsc2VwPSJfIikpICU+JQogIGdncGxvdChhZXMoeCA9IG1kczEsIHkgPSBtZHMyLCBsYWJlbCA9IGxhYiwgY29sb3IgPSBjZWxsdHlwZSwgZ3JvdXAgPSBtb3VzZSkpICsKICBnZW9tX3RleHQoc2hvdy5sZWdlbmQgPSBGQUxTRSkgKwogIGdlb21fcG9pbnQoc2hhcGUgPSAyMSkgKwogIGdlb21fbGluZShjb2xvciA9ICJibGFjayIsIGxpbmV0eXBlID0gImRhc2hlZCIpICsKICB4bGFiKAogICAgcGFzdGUwKAogICAgICBtZHNPYmokYXhpc2xhYmVsLAogICAgICAiICIsCiAgICAgIDEsIAogICAgICAiICgiLAogICAgICBwYXN0ZTAoCiAgICAgICAgcm91bmQobWRzT2JqJHZhci5leHBsYWluZWRbMV0gKjEwMCwwKSwKICAgICAgICAiJSIKICAgICAgICApLAogICAgICAiKSIKICAgICAgKQogICAgKSArCiAgeWxhYigKICAgIHBhc3RlMCgKICAgICAgbWRzT2JqJGF4aXNsYWJlbCwKICAgICAgIiAiLAogICAgICAyLCAKICAgICAgIiAoIiwKICAgICAgcGFzdGUwKAogICAgICAgIHJvdW5kKG1kc09iaiR2YXIuZXhwbGFpbmVkWzJdICoxMDAsMCksCiAgICAgICAgIiUiCiAgICAgICAgKSwKICAgICAgIikiCiAgICAgICkKICAgICkgKwogIGdndGl0bGUoIlJhbmRvbWl6ZWQgQ29tcGxldGUgQmxvY2sgKFJDQikiKQoKCmxldmVscyhjb2xEYXRhKHBlMikkbW91c2UpIDwtIHBhc3RlMCgibSIsMTo4KQptZHNPYmoyIDwtIHBsb3RNRFMoYXNzYXkocGUyW1sicHJvdGVpbiJdXSksIHBsb3QgPSBGQUxTRSkKbWRzQ1JEIDwtIGNvbERhdGEocGUyKSAlPiUKICBhcy5kYXRhLmZyYW1lICU+JQogIG11dGF0ZShtZHMxID0gbWRzT2JqMiR4LAogICAgICAgICBtZHMyID0gbWRzT2JqMiR5LAogICAgICAgICBsYWIgPSBwYXN0ZShtb3VzZSxjZWxsdHlwZSxzZXA9Il8iKSkgJT4lCiAgZ2dwbG90KGFlcyh4ID0gbWRzMSwgeSA9IG1kczIsIGxhYmVsID0gbGFiLCBjb2xvciA9IGNlbGx0eXBlLCBncm91cCA9IG1vdXNlKSkgKwogIGdlb21fdGV4dChzaG93LmxlZ2VuZCA9IEZBTFNFKSArCiAgZ2VvbV9wb2ludChzaGFwZSA9IDIxKSArCiAgeGxhYigKICAgIHBhc3RlMCgKICAgICAgbWRzT2JqJGF4aXNsYWJlbCwKICAgICAgIiAiLAogICAgICAxLCAKICAgICAgIiAoIiwKICAgICAgcGFzdGUwKAogICAgICAgIHJvdW5kKG1kc09iajIkdmFyLmV4cGxhaW5lZFsxXSAqMTAwLDApLAogICAgICAgICIlIgogICAgICAgICksCiAgICAgICIpIgogICAgICApCiAgICApICsKICB5bGFiKAogICAgcGFzdGUwKAogICAgICBtZHNPYmokYXhpc2xhYmVsLAogICAgICAiICIsCiAgICAgIDIsIAogICAgICAiICgiLAogICAgICBwYXN0ZTAoCiAgICAgICAgcm91bmQobWRzT2JqMiR2YXIuZXhwbGFpbmVkWzJdICoxMDAsMCksCiAgICAgICAgIiUiCiAgICAgICAgKSwKICAgICAgIikiCiAgICAgICkKICAgICkgKwogIGdndGl0bGUoIkNvbXBsZXRlbHkgUmFuZG9taXplZCBEZXNpZ24gKENSRCkiKQpgYGAKPC9wPjwvZGV0YWlscz4KYGBge3J9Cm1kc09yaWcKbWRzUkNCCm1kc0NSRApgYGAKCi0gV2Ugb2JzZXJ2ZSB0aGF0IHRoZSBsZWFkaW5nIGZvbGQgY2hhbmdlIGlzIGFjY29yZGluZyB0byBtb3VzZQotIEluIHRoZSBzZWNvbmQgZGltZW5zaW9uIHdlIHNlZSBhIHNlcGFyYXRpb24gYWNjb3JkaW5nIHRvIGNlbGwtdHlwZSAKLSBXaXRoIHRoZSBSYW5kb21pemVkIENvbXBsZXRlIEJsb2NrIGRlc2lnbiAoUkNCKSB3ZSBjYW4gcmVtb3ZlIHRoZSBtb3VzZSBlZmZlY3QgZnJvbSB0aGUgYW5hbHlzaXMhCgoKCgotIFdlIGNhbiBpc29sYXRlIHRoZSBiZXR3ZWVuIGJsb2NrIHZhcmlhYmlsaXR5IGZyb20gdGhlIGFuYWx5c2lzIHVzaW5nIGxpbmVhciBtb2RlbDoKJCQgCnkgXHNpbSBcdGV4dHtjZWxsdHlwZX0gKyBcdGV4dHttb3VzZX0KJCQKCi0gUG9zc2libGUgaW4gbXNxcm9iMiBhbmQgTVNzdGF0cyBidXQgbm90IHBvc3NpYmxlIHdpdGggUGVyc2V1cyEKCgoKIyMgTW9kZWxpbmcgYW5kIGluZmVyZW5jZQoKIyMjIFJDQiBhbmFseXNpcwpgYGB7ciB3YXJuaW5nPUZBTFNFfQpwZSA8LSBtc3Fyb2IoCiAgb2JqZWN0ID0gcGUsCiAgaSA9ICJwcm90ZWluIiwKICBmb3JtdWxhID0gfiBjZWxsdHlwZSArIG1vdXNlKQpgYGAKCiMjIyBSQ0Igd3JvbmcgYW5hbHlzaXMKYGBge3Igd2FybmluZz1GQUxTRX0KcGUgPC0gbXNxcm9iKAogIG9iamVjdCA9IHBlLAogIGkgPSAicHJvdGVpbiIsCiAgZm9ybXVsYSA9IH4gY2VsbHR5cGUsIG1vZGVsQ29sdW1uTmFtZSA9ICJ3cm9uZ01vZGVsIikKYGBgCgojIyMgQ1JEIGFuYWx5c2lzIApgYGB7ciB3YXJuaW5nID0gRkFMU0V9CnBlMiA8LSBtc3Fyb2IoCiAgb2JqZWN0ID0gcGUyLAogIGkgPSAicHJvdGVpbiIsCiAgZm9ybXVsYSA9IH4gY2VsbHR5cGUpCmBgYAoKIyMjIEVzdGltYXRpb24sIGVmZmVjdCBzaXplIGFuZCBpbmZlcmVuY2UKCkVmZmVjdCBzaXplIGluIFJDQgpgYGB7cn0KbGlicmFyeShFeHBsb3JlTW9kZWxNYXRyaXgpClZpc3VhbGl6ZURlc2lnbihjb2xEYXRhKHBlKSx+IGNlbGx0eXBlICsgbW91c2UpJHBsb3RsaXN0CmBgYAoKRWZmZWN0IHNpemUgaW4gQ1JECmBgYHtyfQpWaXN1YWxpemVEZXNpZ24oY29sRGF0YShwZTIpLH4gY2VsbHR5cGUpJHBsb3RsaXN0CmBgYAoKYGBge3J9CkwgPC0gbWFrZUNvbnRyYXN0KCJjZWxsdHlwZVRyZWcgPSAwIiwgcGFyYW1ldGVyTmFtZXMgPSBjKCJjZWxsdHlwZVRyZWciKSkKcGUgPC0gaHlwb3RoZXNpc1Rlc3Qob2JqZWN0ID0gcGUsIGkgPSAicHJvdGVpbiIsIGNvbnRyYXN0ID0gTCkKcGUgPC0gaHlwb3RoZXNpc1Rlc3Qob2JqZWN0ID0gcGUsIGkgPSAicHJvdGVpbiIsIGNvbnRyYXN0ID0gTCwgbW9kZWxDb2x1bW4gPSAid3JvbmdNb2RlbCIsIHJlc3VsdHNDb2x1bW5OYW1lUHJlZml4PSJ3cm9uZyIpCnBlMiA8LSBoeXBvdGhlc2lzVGVzdChvYmplY3QgPSBwZTIsIGkgPSAicHJvdGVpbiIsIGNvbnRyYXN0ID0gTCkKYGBgCgojIyMgQ29tcGFyaXNvbiBvZiByZXN1bHRzCgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgPC9zdW1tYXJ5PjxwPgpgYGB7cn0Kdm9sY2Fub1JDQiA8LSBnZ3Bsb3QoCiAgICByb3dEYXRhKHBlW1sicHJvdGVpbiJdXSkkY2VsbHR5cGVUcmVnLAogICAgYWVzKHggPSBsb2dGQywgeSA9IC1sb2cxMChwdmFsKSwgY29sb3IgPSBhZGpQdmFsIDwgMC4wNSkKKSArCiAgICBnZW9tX3BvaW50KGNleCA9IDIuNSkgKwogICAgc2NhbGVfY29sb3JfbWFudWFsKHZhbHVlcyA9IGFscGhhKGMoImJsYWNrIiwgInJlZCIpLCAwLjUpKSArCiAgICB0aGVtZV9taW5pbWFsKCkgKwogICAgZ2d0aXRsZShwYXN0ZTAoIlJDQjogXG4iLCAKICAgICAgICAgICAgICAgIHN1bShyb3dEYXRhKHBlW1sicHJvdGVpbiJdXSkkY2VsbHR5cGVUcmVnJGFkalB2YWw8MC4wNSxuYS5ybT1UUlVFKSwKICAgICAgICAgICAgIiBzaWduaWZpY2FudCIpKQoKdm9sY2Fub1JDQndyb25nIDwtIGdncGxvdCgKICAgIHJvd0RhdGEocGVbWyJwcm90ZWluIl1dKSR3cm9uZ2NlbGx0eXBlVHJlZywKICAgIGFlcyh4ID0gbG9nRkMsIHkgPSAtbG9nMTAocHZhbCksIGNvbG9yID0gYWRqUHZhbCA8IDAuMDUpCikgKwogICAgZ2VvbV9wb2ludChjZXggPSAyLjUpICsKICAgIHNjYWxlX2NvbG9yX21hbnVhbCh2YWx1ZXMgPSBhbHBoYShjKCJibGFjayIsICJyZWQiKSwgMC41KSkgKwogICAgdGhlbWVfbWluaW1hbCgpICsKICAgIGdndGl0bGUocGFzdGUwKCJSQ0Igd3Jvbmc6IFxuIiwgCiAgICAgICAgICAgICAgICBzdW0ocm93RGF0YShwZVtbInByb3RlaW4iXV0pJHdyb25nY2VsbHR5cGVUcmVnJGFkalB2YWw8MC4wNSxuYS5ybT1UUlVFKSwKICAgICAgICAgICAgIiBzaWduaWZpY2FudCIpKQoKdm9sY2Fub0NSRCA8LSBnZ3Bsb3QoCiAgICByb3dEYXRhKHBlMltbInByb3RlaW4iXV0pJGNlbGx0eXBlVHJlZywKICAgIGFlcyh4ID0gbG9nRkMsIHkgPSAtbG9nMTAocHZhbCksIGNvbG9yID0gYWRqUHZhbCA8IDAuMDUpCikgKwogICAgZ2VvbV9wb2ludChjZXggPSAyLjUpICsKICAgIHNjYWxlX2NvbG9yX21hbnVhbCh2YWx1ZXMgPSBhbHBoYShjKCJibGFjayIsICJyZWQiKSwgMC41KSkgKwogICAgdGhlbWVfbWluaW1hbCgpICsKICAgIGdndGl0bGUocGFzdGUwKCJDUkQ6IFxuIiwgCiAgICAgICAgICAgICAgICBzdW0ocm93RGF0YShwZTJbWyJwcm90ZWluIl1dKSRjZWxsdHlwZVRyZWckYWRqUHZhbDwwLjA1LG5hLnJtPVRSVUUpLAogICAgICAgICAgICAiIHNpZ25pZmljYW50IikpCmBgYAo8L3A+PC9kZXRhaWxzPgogIApgYGB7cn0KZ3JpZC5hcnJhbmdlKHZvbGNhbm9SQ0Isdm9sY2Fub0NSRCwgdm9sY2Fub1JDQndyb25nLG5jb2w9MikKYGBgCgojIyMgQ29tcGFyaXNvbiBvZiBzdGFuZGFyZCBkZXZpYXRpb24gCgo8ZGV0YWlscz48c3VtbWFyeT4gQ2xpY2sgdG8gc2VlIGNvZGUgPC9zdW1tYXJ5PjxwPgpgYGB7cn0KYWNjZXNzaW9ucyA8LSByb3duYW1lcyhwZVtbInByb3RlaW4iXV0pW3Jvd25hbWVzKHBlW1sicHJvdGVpbiJdXSklaW4lcm93bmFtZXMocGUyW1sicHJvdGVpbiJdXSldCmRhdCA8LSBkYXRhLmZyYW1lKApzaWdtYVJCQyA9IHNhcHBseShyb3dEYXRhKHBlW1sicHJvdGVpbiJdXSkkbXNxcm9iTW9kZWxzW2FjY2Vzc2lvbnNdLCBnZXRTaWdtYVBvc3RlcmlvciksCnNpZ21hUkJDd3JvbmcgPSBzYXBwbHkocm93RGF0YShwZVtbInByb3RlaW4iXV0pJHdyb25nTW9kZWxbYWNjZXNzaW9uc10sIGdldFNpZ21hUG9zdGVyaW9yKSwKc2lnbWFDUkQgPC0gc2FwcGx5KHJvd0RhdGEocGUyW1sicHJvdGVpbiJdXSkkbXNxcm9iTW9kZWxzW2FjY2Vzc2lvbnNdLCBnZXRTaWdtYVBvc3RlcmlvcikKKQoKIHBsb3RSQkN2c1dyb25nIDwtIGdncGxvdChkYXRhID0gZGF0LCBhZXMoc2lnbWFSQkMsIHNpZ21hUkJDd3JvbmcpKSArCiAgICBnZW9tX3BvaW50KGFscGhhID0gMC4xLCBzaGFwZSA9IDIwKSArCiAgICBzY2FsZV94X2xvZzEwKCkgKwogICAgc2NhbGVfeV9sb2cxMCgpICsKICAgIGdlb21fYWJsaW5lKGludGVyY2VwdD0wLHNsb3BlPTEpCnBsb3RDUkR2c1dyb25nIDwtIGdncGxvdChkYXRhID0gZGF0LCBhZXMoc2lnbWFDUkQsIHNpZ21hUkJDd3JvbmcpKSArCiAgICBnZW9tX3BvaW50KGFscGhhID0gMC4xLCBzaGFwZSA9IDIwKSArCiAgICBzY2FsZV94X2xvZzEwKCkgKwogICAgc2NhbGVfeV9sb2cxMCgpICsKICAgIGdlb21fYWJsaW5lKGludGVyY2VwdD0wLHNsb3BlPTEpCnBsb3RSQkN2c0NSRCA8LSBnZ3Bsb3QoZGF0YSA9IGRhdCwgYWVzKHNpZ21hUkJDLCBzaWdtYUNSRCkpICsKICAgIGdlb21fcG9pbnQoYWxwaGEgPSAwLjEsIHNoYXBlID0gMjApICsKICAgIHNjYWxlX3hfbG9nMTAoKSArCiAgICBzY2FsZV95X2xvZzEwKCkgKwogICAgZ2VvbV9hYmxpbmUoaW50ZXJjZXB0PTAsc2xvcGU9MSkKYGBgCjwvcD48L2RldGFpbHM+CgpgYGB7cn0KZ3JpZC5hcnJhbmdlKAogIHBsb3RSQkN2c1dyb25nLAogIHBsb3RDUkR2c1dyb25nLAogIHBsb3RSQkN2c0NSRCwKICBucm93PTIpCmBgYAoKLSBXZSBjbGVhcmx5IG9ic2VydmUgdGhhdCB0aGUgc3RhbmRhcmQgZGV2aWF0aW9uIG9mIHRoZSBwcm90ZWluIGV4cHJlc3Npb24gaW4gdGhlIFJDQiBpcyBzbWFsbGVyIGZvciB0aGUgbWFqb3JpdHkgb2YgdGhlIHByb3RlaW5zIHRoYW4gdGhhdCBvYnRhaW5lZCB3aXRoIHRoZSBDUkQKCi0gVGhlIHN0YW5kYXJkIGRldmlhdGlvbiBvZiB0aGUgcHJvdGVpbiBleHByZXNzaW9uIFJDQiB3aGVyZSB3ZSBwZXJmb3JtIGEgd3JvbmcgYW5hbHlzaXMgd2l0aG91dCBjb25zaWRlcmluZyB0aGUgYmxvY2tpbmcgZmFjdG9yIGFjY29yZGluZyB0byBtb3VzZSBpcyBtdWNoIGxhcmdlciBmb3IgdGhlIG1hcmpvcml0eSBvZiB0aGUgcHJvdGVpbnMgdGhhbiB0aGF0IG9idGFpbmVkIHdpdGggdGhlIGNvcnJlY3QgYW5hbHlzaXMuIAoKLSBJbmRlZWQsIHdoZW4gd2UgaWdub3JlIHRoZSBibG9ja2luZyBmYWN0b3IgaW4gdGhlIFJDQiBkZXNpZ24gd2UgZG8gbm90IHJlbW92ZSB0aGUgdmFyaWFiaWxpdHkgYWNjb3JkaW5nIHRvIG1vdXNlIGZyb20gdGhlIGFuYWx5c2lzIGFuZCB0aGUgbW91c2UgZWZmZWN0IGlzIGFic29yYmVkIGluIHRoZSBlcnJvciB0ZXJtLiBUaGUgc3RhbmRhcmQgZGV2aWF0aW9uIHRoYW4gYmVjb21lcyB2ZXJ5IGNvbXBhcmFibGUgdG8gdGhhdCBvYnNlcnZlZCBpbiB0aGUgY29tcGxldGVseSByYW5kb21pc2VkIGRlc2lnbiB3aGVyZSB3ZSBjb3VsZCBub3QgcmVtb3ZlIHRoZSBtb3VzZSBlZmZlY3QgZnJvbSB0aGUgYW5hbHlzaXMuIAoKLSBXaHkgYXJlIHNvbWUgb2YgdGhlIHN0YW5kYXJkIGRldmlhdGlvbnMgZm9yIHRoZSBSQ0Igd2l0aCB0aGUgY29ycmVjdCBhbmFseXNpcyBsYXJnZXIgdGhhbiB0aGFuIG9mIHRoZSBSQ0Igd2l0aCB0aGUgaW5jb3JyZWN0IGFuYWx5c2lzIHRoYXQgaWdub3JlZCB0aGUgbW91c2UgYmxvY2tpbmcgZmFjdG9yPwoKLSBDYW4geW91IHRoaW5rIG9mIGEgcmVhc29uIHdoeSBpdCB3b3VsZCBub3QgYmUgdXNlZnVsIHRvIGJsb2NrIG9uIGEgcGFydGljdWxhciBmYWN0b3I/IAoK</div>


</div>
</div>

</div>

<script>

// add bootstrap table styles to pandoc tables
function bootstrapStylePandocTables() {
  $('tr.odd').parent('tbody').parent('table').addClass('table table-condensed');
}
$(document).ready(function () {
  bootstrapStylePandocTables();
});


</script>

<!-- tabsets -->

<script>
$(document).ready(function () {
  window.buildTabsets("TOC");
});

$(document).ready(function () {
  $('.tabset-dropdown > .nav-tabs > li').click(function () {
    $(this).parent().toggleClass('nav-tabs-open');
  });
});
</script>

<!-- code folding -->
<script>
$(document).ready(function () {
  window.initializeSourceEmbed("experimentalDesign.Rmd");
});
</script>

<script>
$(document).ready(function ()  {

    // temporarily add toc-ignore selector to headers for the consistency with Pandoc
    $('.unlisted.unnumbered').addClass('toc-ignore')

    // move toc-ignore selectors from section div to header
    $('div.section.toc-ignore')
        .removeClass('toc-ignore')
        .children('h1,h2,h3,h4,h5').addClass('toc-ignore');

    // establish options
    var options = {
      selectors: "h1,h2,h3",
      theme: "bootstrap3",
      context: '.toc-content',
      hashGenerator: function (text) {
        return text.replace(/[.\\/?&!#<>]/g, '').replace(/\s/g, '_');
      },
      ignoreSelector: ".toc-ignore",
      scrollTo: 0
    };
    options.showAndHide = true;
    options.smoothScroll = true;

    // tocify
    var toc = $("#TOC").tocify(options).data("toc-tocify");
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
